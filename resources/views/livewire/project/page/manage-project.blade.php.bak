<div class="container mx-auto px-2 sm:px-4">
    <style>
        /* Custom breakpoint for extra small screens */
        @media (min-width: 475px) {
            .xs\:inline {
                display: inline;
            }

            .xs\:block {
                display: block;
            }

            .xs\:hidden {
                display: none;
            }
        }

        /* Ensure content doesn't overflow on small screens */
        .overflow-x-auto {
            overflow-x: auto;
        }

        /* Ensure text doesn't overflow */
        .break-words {
            word-break: break-word;
        }

        /* Fix for file input on small screens */
        .file-input {
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Fix for track filenames */
        .track-filename {
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
        }

        /* Ensure track list items don't expand beyond container */
        .track-item {
            width: 100%;
            min-width: 0;
        }

        /* Force track container to respect parent width */
        .tracks-container {
            width: 100%;
            max-width: 100%;
            min-width: 0;
        }

        /* Responsive track items on very small screens */
        @media (max-width: 380px) {
            .track-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .track-item .track-actions {
                margin-top: 0.5rem;
                margin-left: 2.5rem;
                width: 100%;
                display: flex;
                justify-content: flex-start;
            }
        }

        /* Ensure consistent button sizing in pitch actions */
        .pitch-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }

        .pitch-actions>* {
            flex: 0 0 auto;
        }

        /* Fix layout issues at medium screen sizes */
        @media (min-width: 640px) and (max-width: 800px) {
            .pitch-status-wrapper {
                flex-direction: column;
                align-items: flex-end;
            }

            .pitch-status-wrapper>div {
                margin-bottom: 0.5rem;
            }
        }

        @media (max-width: 640px) {
            .pitch-actions {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }

            .pitch-actions>* {
                width: 100%;
            }
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .project-header-image {
                width: 100%;
                height: auto;
                max-height: 200px;
                margin: 0 auto;
                display: flex;
            }
            
            .project-header-details {
                padding: 1rem 0.75rem;
            }
            
            .project-metadata-row {
                min-width: 100%;
                overflow-x: auto;
            }
        }
    </style>
    <div class="flex justify-center">
        <div class="w-full lg:w-3/4 2xl:w-2/3">
            <div class="border-transparent shadow-2xl shadow-base-300 rounded-lg mb-6 sm:mb-12 flex flex-col">
                <div class="flex flex-col md:flex-row shadow-lightGlow shadow-base-300 h-full">
                    <!-- Project Image on the Left -->
                    <div x-data="{ lightbox: { isOpen: false } }" class="relative shrink-0 md:w-72 project-header-image">

                        <!-- Image that triggers the lightbox -->
                        @if($project->image_path)
                        <img @click="lightbox.isOpen = true" src="{{ $project->imageUrl }}"
                            class="rounded-lg shadow-lg cursor-pointer transition-all duration-200 hover:shadow-xl max-h-56 md:max-h-none object-cover mx-auto md:mx-0 w-full md:w-auto"
                            alt="{{ $project->name }}">
                        @else
                        <div
                            class="w-full md:aspect-square md:w-72 h-56 sm:h-72 object-cover lg:rounded-tl-lg bg-base-200 flex items-center justify-center">
                            <i class="fas fa-music text-5xl sm:text-6xl text-base-300"></i>
                        </div>
                        @endif
                        @if($this->hasPreviewTrack)
                        <div
                            class="flex absolute h-auto w-auto top-auto -bottom-1 -left-1 right-auto z-50 aspect-auto text-sm">
                            @livewire('audio-player', ['audioUrl' => $project->previewTrackPath(), 'isInCard' => true])
                        </div>
                        @endif

                        <div class="md:hidden absolute top-0 right-0">
                            <x-project-status-button :status="$project->status" type="top-right" />
                        </div>

                        <!-- The actual lightbox overlay -->
                        @if($project->image_path)
                        <div x-cloak x-show="lightbox.isOpen" 
                            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 transition-all duration-300"
                            x-transition:enter="transition ease-out duration-300"
                            x-transition:enter-start="opacity-0"
                            x-transition:enter-end="opacity-100"
                            x-transition:leave="transition ease-in duration-200"
                            x-transition:leave-start="opacity-100"
                            x-transition:leave-end="opacity-0">
                            
                            <div class="relative max-w-4xl mx-auto">
                                <img class="max-h-[90vh] max-w-[90vw] object-contain shadow-2xl rounded" 
                                    src="{{ $project->imageUrl }}" 
                                    alt="{{ $project->name }}">
                                
                                <button @click="lightbox.isOpen = false" 
                                    class="absolute top-4 right-4 text-white bg-gray-900 bg-opacity-50 hover:bg-opacity-75 rounded-full p-2 transition-colors duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        @endif
                    </div>

                    <!-- Project Details on the Right -->
                    <div class="flex-1 overflow-x-auto flex flex-col md:h-72 justify-between project-header-details">
                        <div class="flex flex-col p-3 sm:p-4 md:p-6">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                                <a href="{{ route('projects.show', $project) }}"
                                    class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800 break-words hover:text-primary transition-colors text-center md:text-left">
                                    {{ $project->name }}
                                </a>
                            </div>

                            @if($project->artist_name)
                            <div class="py-1 flex items-center justify-center md:justify-start">
                                <span class="font-semibold text-gray-700 mr-2">Artist:</span>
                                <span class="text-gray-900">{{ $project->artist_name }}</span>
                            </div>
                            @endif

                            <!-- User info -->
                            <div class="flex items-center w-full mt-2 justify-center md:justify-start">
                                <img class="h-10 w-10 rounded-full object-cover mr-3 border-2 border-base-300"
                                    src="{{ $project->user->profile_photo_url }}" alt="{{ $project->user->name }}" />
                                <div class="flex flex-col">
                                    <span class="text-base max-w-xs truncate font-medium">{{ $project->user->name
                                        }}</span>
                                    <span class="text-xs text-gray-600">Project Owner</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-auto">
                            <!-- Edit button -->
                            <div class="flex w-full mt-4">
                                <a href="{{ route('projects.edit', $project)}}" class="block bg-warning/80 hover:bg-warning tracking-tight text-xl text-center font-bold
                                                               grow py-2 px-4 shadow-accent hover:shadow-accent-focus
                                                               whitespace-nowrap transition-colors">
                                    <i class="fas fa-edit mr-2"></i> Edit Project Details
                                </a>
                            </div>

                            <!-- Project metadata -->
                            <div class="font-sans w-full border-t border-b border-base-200 overflow-x-auto">
                                <div class="flex flex-row min-w-full project-metadata-row">
                                    <div
                                        class="px-2 py-1 md:px-4 flex-1 bg-base-200/70 text-center sm:text-right border-r border-base-200">
                                        <div class="label-text whitespace-nowrap text-gray-600 text-xs sm:text-sm">Project Type</div>
                                        <div class="font-bold text-sm sm:text-base">{{ Str::title($project->project_type) }}</div>
                                    </div>
                                    <div
                                        class="py-1 pb-0 px-2 md:px-4 flex-1 bg-base-200/30 border-r border-base-200 text-center">
                                        <div class="label-text text-gray-600 text-xs sm:text-sm">Budget</div>
                                        <div class="font-bold text-sm sm:text-base">
                                            <div>@if(is_numeric($project->budget) && $project->budget > 0) 
                                                ${{ number_format((float)$project->budget, 0) }} 
                                                @elseif(is_numeric($project->budget) && $project->budget == 0)
                                                Free
                                                @else
                                                Price TBD 
                                                @endif</div>
                                        </div>
                                    </div>
                                    <div class="py-1 pb-0 px-2 md:px-4 flex-1 bg-base-200/70 text-center sm:text-left">
                                        <div class="label-text text-gray-600 text-xs sm:text-sm">Deadline</div>
                                        <div class="whitespace-nowrap font-bold text-sm sm:text-base">{{
                                            \Carbon\Carbon::parse($project->deadline)->format('M d, Y') }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-0 sm:p-2 md:p-4 grid md:grid-cols-2 gap-3 sm:gap-4">

                    <div
                        class="flex w-full flex-col md:col-span-2 bg-base-100 rounded-lg shadow-md border border-base-300">
                        <div class="p-3 sm:p-4 flex flex-col">
                            <span class="text-lg sm:text-xl font-bold mb-2 flex items-center">
                                <i
                                    class="fas {{ $project->status == 'completed' ? 'fa-check-circle text-success' : 'fa-toggle-off text-gray-500' }} mr-2"></i>
                                Project Status
                            </span>

                            @if($project->status == 'completed')
                            <div class="mb-3 sm:mb-4">
                                <div class="p-2.5 sm:p-3 bg-success/20 border-l-4 border-success rounded-r-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-trophy mr-1.5 sm:mr-2"></i>
                                        <span class="font-medium text-sm sm:text-base">This project has been completed!</span>
                                    </div>
                                    <p class="text-xs sm:text-sm mt-1 text-gray-700">
                                        A pitch has been selected and marked as completed
                                        @if($project->completed_at)
                                        on {{ $project->completed_at->format('M d, Y') }}.
                                        @endif
                                    </p>
                                </div>
                            </div>
                            @endif

                            @if($hasMultipleApprovedPitches && !$hasCompletedPitch)
                            <div class="mb-3 sm:mb-4">
                                <div class="p-2.5 sm:p-3 bg-amber-100 border-l-4 border-amber-400 rounded-r-lg">
                                    <div class="flex items-center">
                                        <i class="fas fa-exclamation-circle text-amber-600 mr-1.5 sm:mr-2"></i>
                                        <span class="font-medium text-sm sm:text-base text-amber-800">Multiple Approved Pitches</span>
                                    </div>
                                    <p class="text-xs sm:text-sm mt-1 text-amber-800">
                                        There are {{ $approvedPitchesCount }} approved pitches for this project. You'll
                                        need to choose one to mark as completed. The other approved pitches will be
                                        automatically closed.
                                    </p>
                                </div>
                            </div>
                            @endif

                            @if(!$project->is_published)
                            <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">Your project is currently unpublished and not visible to
                                potential collaborators.</p>
                            <div class="btn flex-row bg-primary hover:bg-primary-focus text-white text-center transition-colors py-2.5 sm:py-2 text-sm sm:text-base"
                                wire:click="publish()">
                                <i class="fas fa-globe mr-2"></i> Publish Project
                            </div>
                            @else
                            <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">Your project is currently published and visible to potential
                                collaborators.</p>
                            <div class="btn flex-row bg-warning hover:bg-warning/80 text-black text-center transition-colors py-2.5 sm:py-2 text-sm sm:text-base"
                                wire:click="unpublish()">
                                <i class="fas fa-eye-slash mr-2"></i> Unpublish Project
                            </div>
                            @endif
                        </div>
                    </div>
                    <div
                        class="flex w-full flex-col md:col-span-2 bg-base-100 rounded-lg shadow-md border border-base-300">
                        <div class="p-3 sm:p-4 flex flex-col">
                            <span class="text-lg sm:text-xl font-bold mb-2 flex items-center">
                                <i class="fas fa-paper-plane w-5 text-center mr-3 text-blue-500"></i>Pitches
                            </span>
                            <div class="flex flex-col divide-y divide-base-300/50">
                                @if($project->isStandard() || $project->isContest())
                                    @forelse ($project->pitches as $pitch)
                                        @livewire('pitch.component.manage-pitch', ['pitch' => $pitch, 'project' => $project, 'key' => 'pitch-' . $pitch->id])
                                    @empty
                                        <div class="p-8 sm:p-10 text-center text-gray-500 italic">
                                            <i class="fas fa-paper-plane text-4xl sm:text-5xl text-gray-300 mb-3"></i>
                                            <p class="text-base sm:text-lg">No pitches have been submitted yet</p>
                                            <p class="text-xs sm:text-sm mt-2">When users submit pitches for your project, they will appear here</p>
                                        </div>
                                    @endforelse
                                @elseif($project->isDirectHire())
                                    @if($project->pitches->count() > 0)
                                        @livewire('pitch.component.manage-pitch', ['pitch' => $project->pitches->first(), 'project' => $project, 'key' => 'pitch-' . $project->pitches->first()->id])
                                    @else
                                        <div class="p-8 sm:p-10 text-center text-gray-500 italic">
                                            <i class="fas fa-paper-plane text-4xl sm:text-5xl text-gray-300 mb-3"></i>
                                            <p class="text-base sm:text-lg">No pitches have been submitted yet</p>
                                            <p class="text-xs sm:text-sm mt-2">When users submit pitches for your project, they will appear here</p>
                                        </div>
                                    @endif
                                @elseif($project->isClientManagement())
                                    @if($project->pitches->count() > 0)
                                        @livewire('pitch.component.manage-pitch', ['pitch' => $project->pitches->first(), 'project' => $project, 'key' => 'pitch-' . $project->pitches->first()->id])
                                    @else
                                        <div class="p-8 sm:p-10 text-center text-gray-500 italic">
                                            <i class="fas fa-paper-plane text-4xl sm:text-5xl text-gray-300 mb-3"></i>
                                            <p class="text-base sm:text-lg">No pitches have been submitted yet</p>
                                            <p class="text-xs sm:text-sm mt-2">When users submit pitches for your project, they will appear here</p>
                                        </div>
                                    @endif
                                @endif
                            </div>
                        </div>
                    </div>

                    @if(!$project->isContest())
                    <!-- Upload Files Section -->
                    <div x-data="{ showUploader: true }" class="p-3 sm:p-4 flex flex-col md:col-span-2 bg-base-100 rounded-lg shadow-md border border-base-300">
                        <div class="flex items-center justify-between mb-2 sm:mb-3">
                            <span class="text-lg sm:text-xl font-bold flex items-center">
                                <i class="fas fa-upload w-5 text-center mr-2 text-primary"></i>Project Files
                            </span>
                            <button 
                                @click="showUploader = !showUploader" 
                                class="btn btn-sm bg-base-200 hover:bg-base-300 text-gray-700 transition-colors"
                            >
                                <span x-text="showUploader ? 'Hide Uploader' : 'Show Uploader'"></span>
                                <i class="fas ml-1" :class="showUploader ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                            </button>
                        </div>
                        
                        <!-- Storage Usage Indicator -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium text-gray-700">Storage Used: {{ $storageLimitMessage }}</span>
                                <span class="text-xs text-gray-500">{{ $this->formatFileSize($storageRemaining) }} remaining</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full transition-all duration-500 {{ $storageUsedPercentage > 90 ? 'bg-red-500' : ($storageUsedPercentage > 70 ? 'bg-amber-500' : 'bg-primary') }}"
                                    style="width: {{ $storageUsedPercentage }}%"></div>
                            </div>
                            <p class="mt-1 text-xs text-gray-500">
                                <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                                Maximum file size: 200MB. Total storage limit: 1GB.
                            </p>
                        </div>
                        
                        <!-- File Uploader Component -->
                        <div x-show="showUploader" x-transition class="bg-white rounded-lg border border-base-300 shadow-sm overflow-hidden mb-4">
                            <div class="p-4 border-b border-base-200 bg-base-100/50">
                                <h5 class="font-medium text-base">Upload New Files</h5>
                                <p class="text-xs text-gray-500 mt-1">Upload audio, PDFs, or images to share with collaborators</p>
                            </div>
                            <div class="p-4">
                                <livewire:file-uploader :model="$project" wire:key="project-uploader-{{ $project->id }}" />
                            </div>
                        </div>
                        
                        <!-- Files List Section -->
                        <div class="bg-white rounded-lg border border-base-300 shadow-sm overflow-hidden">
                            <div class="p-4 border-b border-base-200 bg-base-100/50 flex justify-between items-center">
                                <h5 class="font-medium text-base">Files ({{ $project->files->count() }})</h5>
                                <div class="flex items-center">
                                    @if($project->files->count() > 0)
                                    <span class="text-xs text-gray-500">Total: {{ $this->formatFileSize($project->files->sum('size')) }}</span>
                                    @endif
                                </div>
                            </div>
                            
                            <div class="divide-y divide-base-200">
                                @forelse($project->files as $file)
                                <div class="flex items-center justify-between py-3 px-4 hover:bg-base-100/50 transition-all duration-300 track-item
                                    @if(isset($newlyUploadedFileIds) && in_array($file->id, $newlyUploadedFileIds)) animate-fade-in @endif">
                                    <div class="flex items-center overflow-hidden flex-1 pr-2">
                                        <div
                                            class="w-8 h-8 sm:w-10 sm:h-10 rounded-full flex-shrink-0 flex items-center justify-center {{ $file->id == $project->preview_track ? 'bg-primary text-white' : 'bg-base-200 text-gray-500' }} mr-3">
                                            <i class="fas fa-music text-sm sm:text-base"></i>
                                        </div>
                                        <div class="min-w-0 flex-1">
                                            <div class="font-medium truncate text-sm sm:text-base">{{ $file->file_name }}
                                                @if($file->id == $project->preview_track)
                                                <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary/20 text-primary">
                                                    <i class="fas fa-star mr-1"></i>Preview
                                                </span>
                                                @endif
                                            </div>
                                            <div class="flex items-center text-xs text-gray-500">
                                                <span>{{ $file->created_at->format('M d, Y') }}</span>
                                                <span class="mx-1.5">•</span>
                                                <span>{{ $file->formatted_size }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-1 sm:space-x-2">
                                        @if($file->id != $project->preview_track)
                                        <button wire:click="togglePreviewTrack({{ $file->id }})"
                                            class="btn btn-sm btn-ghost text-gray-600 hover:text-primary">
                                            <i class="fas fa-star"></i>
                                        </button>
                                        @else
                                        <button wire:click="clearPreviewTrack"
                                            class="btn btn-sm btn-ghost text-primary hover:text-gray-600">
                                            <i class="fas fa-star-half-alt"></i>
                                        </button>
                                        @endif
                                        
                                        <button wire:click="getDownloadUrl({{ $file->id }})"
                                            class="btn btn-sm btn-ghost text-gray-600 hover:text-blue-600">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        
                                        <button wire:click="confirmDeleteFile({{ $file->id }})"
                                            class="btn btn-sm btn-ghost text-gray-600 hover:text-red-600">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                @empty
                                <div class="p-8 sm:p-10 text-center text-gray-500 italic">
                                    <i class="fas fa-folder-open text-4xl sm:text-5xl text-gray-300 mb-3"></i>
                                    <p class="text-base sm:text-lg">No files uploaded yet</p>
                                    <p class="text-xs sm:text-sm mt-2">Upload files to share with collaborators</p>
                                </div>
                                @endforelse
                            </div>
                        </div>
                    </div>
                    @endif

                    <div class="flex w-full flex-col md:col-span-2 bg-base-100 rounded-lg shadow-md border border-base-300"
                        x-data="{ open: false }">
                        <div class="p-3 sm:p-4 flex flex-col">
                            <span class="text-lg sm:text-xl font-bold mb-2 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-2 text-red-500"></i>Danger Zone
                            </span>
                            <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">Permanently delete this project and all associated files. This
                                action cannot be undone.</p>
                            <div class="btn bg-error/80 hover:bg-error flex-row text-white text-center transition-colors py-2.5 sm:py-2 text-sm sm:text-base"
                                @click="open = true" onclick="event.stopPropagation();">
                                <i class="fas fa-trash-alt mr-2"></i> Delete Project
                            </div>
                        </div>
                        <!-- Modal -->
                        <div x-show="open" x-cloak class="fixed z-10 inset-0 overflow-y-auto"
                            aria-labelledby="modal-title" role="dialog" aria-modal="true"
                            @click="$event.stopPropagation()">
                            <div class="flex items-center justify-center min-h-screen p-2 sm:p-0">
                                <!-- Background overlay -->
                                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                                    aria-hidden="true"></div>

                                <!-- Modal -->
                                <span class="hidden sm:inline-block sm:align-middle sm:h-screen"
                                    aria-hidden="true">&#8203;</span>
                                <div
                                    class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full max-w-sm sm:w-full">
                                    <div
                                        class="bg-white rounded-lg text-left overflow-hidden shadow-xl p-3 sm:p-4 transform transition-all sm:align-middle sm:max-w-lg sm:w-full">
                                        <h3 class="text-base sm:text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                            Confirm Deletion
                                        </h3>
                                        <div class="mt-2">
                                            <p class="text-xs sm:text-sm text-gray-500">
                                                Are you sure you want to delete this project?
                                            </p>
                                        </div>
                                    </div>
                                    <div class="bg-gray-50 px-3 sm:px-4 py-2 sm:py-3 flex flex-col sm:flex-row-reverse gap-2">
                                        <!-- Confirm Button -->
                                        <form action="{{ route('projects.destroy', $project) }}" method="POST">
                                            @csrf
                                            @method('DELETE')
                                            <button type="submit" class="btn-sm bg-red-400 border py-1.5 sm:py-1 text-xs sm:text-sm w-full sm:w-auto">
                                                Confirm
                                            </button>
                                        </form>
                                        <!-- Cancel Button -->
                                        <button @click="open = false" class="btn-sm border py-1.5 sm:py-1 text-xs sm:text-sm w-full sm:w-auto">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            {{-- Workflow Type Specific Information --}}
            @if($project->isContest())
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-lg text-blue-800 mb-2"><i class="fas fa-trophy mr-2"></i>Contest Details</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                        <div><strong>Prize Amount:</strong> {{ $project->prize_currency ?? '$' }}{{ number_format($project->prize_amount, 2) }}</div>
                        <div><strong>Submission Deadline:</strong> {{ $project->submission_deadline ? $project->submission_deadline->format('M d, Y H:i T') : 'Not set' }}</div>
                        <div><strong>Judging Deadline:</strong> {{ $project->judging_deadline ? $project->judging_deadline->format('M d, Y H:i T') : 'Not set' }}</div>
                    </div>
                    {{-- Add logic here for selecting winner if deadline passed and owner is viewing --}}
                </div>
            @elseif($project->isDirectHire())
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                     <h3 class="font-semibold text-lg text-green-800 mb-2"><i class="fas fa-user-check mr-2"></i>Direct Hire Details</h3>
                    @if($project->targetProducer)
                        <p class="text-sm">This project is directly assigned to:
                            <a href="{{ route('users.show', $project->targetProducer) }}" class="font-semibold text-green-700 hover:underline">
                                {{ $project->targetProducer->name }}
                            </a>
                            ({{ $project->targetProducer->email }})
                        </p>
                    @else
                         <p class="text-sm text-red-600">Target producer not found or not set.</p>
                    @endif
                </div>
            @elseif($project->isClientManagement())
                 <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                     <h3 class="font-semibold text-lg text-purple-800 mb-2"><i class="fas fa-briefcase mr-2"></i>Client Management Details</h3>
                     <p class="text-sm"><strong>Client Name:</strong> {{ $project->client_name ?? 'N/A' }}</p>
                     <p class="text-sm"><strong>Client Email:</strong> {{ $project->client_email ?? 'N/A' }}</p>
                     {{-- Add Resend Invite Button --}}
                     @can('update', $project) {{-- Only project owner (producer) can resend --}}
                        <button wire:click="resendClientInvite" class="btn btn-sm btn-outline btn-primary mt-2">
                            <i class="fas fa-paper-plane mr-1"></i> Resend Client Invite
                        </button>
                     @endcan
                 </div>
            @endif
            {{-- End Workflow Type Specific Information --}}

            {{-- Show Pitch Management Sections Based on Workflow Type --}}

            @if($project->isStandard() || $project->isContest())
                {{-- Standard and Contest Pitch List --}}
                <div class="bg-base-100 rounded-lg shadow-md border border-base-300 mt-6 overflow-hidden">
                    <div class="p-4 bg-base-200/60 border-b border-base-300">
                        <h2 class="text-xl font-semibold flex items-center">
                            <i class="fas {{ $project->isContest() ? 'fa-trophy text-yellow-500' : 'fa-microphone-alt text-blue-500' }} mr-3"></i>
                            {{ $project->isContest() ? 'Contest Entries' : 'Pitches' }}
                            <span class="ml-2 text-sm font-normal text-gray-500">({{ $project->pitches->count() }})</span>

                            {{-- Contest Specific Info --}}
                            @if($project->isContest())
                            <div class="ml-auto text-sm space-x-4">
                                 @if($project->prize_amount)
                                    <span class="font-semibold text-green-600">
                                        <i class="fas fa-award mr-1"></i> Prize: {{ $project->prize_currency }} {{ number_format($project->prize_amount, 2) }}
                                    </span>
                                @endif
                                 @if($project->submission_deadline)
                                    <span class="{{ $project->submission_deadline->isPast() ? 'text-red-600' : 'text-gray-600' }}">
                                        <i class="far fa-clock mr-1"></i> Submission Deadline: {{ $project->submission_deadline->format('M d, Y H:i') }}
                                    </span>
                                @endif
                            </div>
                            @endif
                        </h2>
                        @if($project->isContest() && $project->judging_deadline)
                            <p class="text-sm text-gray-600 mt-1">
                                 <i class="far fa-calendar-alt mr-1"></i> Judging Deadline: {{ $project->judging_deadline->format('M d, Y H:i') }}
                            </p>
                        @endif
                    </div>
                    <div class="p-4 space-y-4">
                        @if($project->pitches->isEmpty())
                        <div class="text-center text-gray-500 py-6">
                            <i class="fas fa-ghost text-3xl mb-2"></i>
                            <p>No {{ $project->isContest() ? 'entries' : 'pitches' }} submitted yet.</p>
                        </div>
                        @else
                            {{-- Load standard/contest pitches if not already eager loaded --}}
                            @php
                                if (!$project->relationLoaded('pitches')) {
                                    $project->load('pitches.user');
                                }
                            @endphp
                            @foreach($project->pitches->sortByDesc('created_at') as $pitch)
                                @livewire('pitch.component.manage-pitch', ['pitch' => $pitch], key($pitch->id))
                            @endforeach
                        @endif
                    </div>
                </div>
            @elseif($project->isDirectHire())
                {{-- Direct Hire Section --}}
                <div class="bg-base-100 rounded-lg shadow-md border border-base-300 mt-6 overflow-hidden">
                    <div class="p-4 bg-base-200/60 border-b border-base-300">
                        <h2 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-user-check text-purple-500 mr-3"></i>
                            Direct Hire Assignment
                        </h2>
                         @if($project->relationLoaded('targetProducer') && $project->targetProducer)
                            <p class="text-sm text-gray-700 mt-1">Assigned Producer:
                                <a href="{{ route('profile.show', $project->targetProducer->id) }}" class="font-semibold text-primary hover:underline">
                                    {{ $project->targetProducer->name }}
                                </a>
                            </p>
                        @else
                            <p class="text-sm text-red-600 mt-1">Target producer information loading or not found.</p>
                        @endif
                    </div>
                    <div class="p-4 space-y-4">
                        @php
                            // Ensure pitches relation is loaded
                            if (!$project->relationLoaded('pitches')) {
                                $project->load('pitches');
                            }
                            $singlePitch = $project->pitches->first();
                        @endphp
                        @if($singlePitch)
                            {{-- Pass the single pitch to the ManagePitch component --}}
                            @livewire('pitch.component.manage-pitch', ['pitch' => $singlePitch], key($singlePitch->id))
                        @else
                            <div class="text-center text-gray-500 py-6">
                                <i class="fas fa-exclamation-triangle text-3xl mb-2 text-warning"></i>
                                <p>Pitch assignment is pending or encountered an issue.</p>
                                <p class="text-xs">(Observer might be processing)</p>
                            </div>
                        @endif
                    </div>
                </div>
            @elseif($project->isClientManagement())
                {{-- Client Management Section --}}
                 <div class="bg-base-100 rounded-lg shadow-md border border-base-300 mt-6 overflow-hidden">
                    <div class="p-4 bg-base-200/60 border-b border-base-300">
                        <h2 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-briefcase text-indigo-500 mr-3"></i>
                            Client Management
                        </h2>
                        <div class="text-sm text-gray-700 mt-1 space-y-1">
                            <p>Client: <span class="font-semibold">{{ $project->client_name ?: 'N/A' }}</span></p>
                            <p>Email: <span class="font-semibold">{{ $project->client_email }}</span></p>
                            {{-- Add button to resend client invite here eventually --}}
                            {{-- <button wire:click="resendClientInvite" class="btn btn-sm btn-outline btn-info mt-2">Resend Client Invite</button> --}}
                            {{-- @error('resendInvite') <span class="text-error text-xs ml-2">{{ $message }}</span> @enderror --}}
                        </div>
                    </div>
                    <div class="p-4 space-y-4">
                         @php
                            // Ensure pitches relation is loaded
                            if (!$project->relationLoaded('pitches')) {
                                $project->load(['pitches' => function($q) use ($project) {
                                    $q->where('user_id', $project->user_id);
                                }]);
                            }
                            $singlePitch = $project->pitches->first();
                         @endphp
                         @if($singlePitch)
                            {{-- The pitch belongs to the producer managing the client work --}}
                            @livewire('pitch.component.manage-pitch', ['pitch' => $singlePitch], key($singlePitch->id))
                         @else
                            <div class="text-center text-gray-500 py-6">
                                <i class="fas fa-exclamation-triangle text-3xl mb-2 text-warning"></i>
                                <p>Client project setup is pending or encountered an issue.</p>
                                 <p class="text-xs">(Observer might be processing)</p>
                            </div>
                         @endif
                    </div>
                </div>
            @endif
        </div>
    </div>

{{-- File Delete Confirmation Modal --}}
@if($showDeleteModal)
<div class="fixed z-[9999] inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-center justify-center min-h-screen p-4 text-center">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
        
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="flex items-center">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <div class="mt-3 ml-4 text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Delete File
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Are you sure you want to delete this file? This action cannot be undone.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-2">
                <button wire:click="deleteFile" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700">
                    Delete
                </button>
                <button wire:click="cancelDeleteFile" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>
@endif

{{-- Show Contest Entries component only for contest projects --}}
@if($project->isContest())
    <div class="mt-6">
         @livewire('project.component.contest-entries', ['project' => $project], key('contest-entries-'.$project->id))
    </div>
@endif
{{-- End Contest Entries --}}

{{-- Project Content Tabs (Consider hiding these if project is a contest) --}}
<div class="mt-6">
    <div class="border-b border-gray-200">

</div>


</div>
