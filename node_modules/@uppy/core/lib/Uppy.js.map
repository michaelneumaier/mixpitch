{"version":3,"names":["Translator","ee","nanoid","throttle","DefaultStore","getFileType","getFileNameAndExtension","getSafeFileId","supportsUploadProgress","getFileName","justErrorsLogger","debugLogger","Restricter","defaultOptions","defaultRestrictionOptions","RestrictionError","packageJson","locale","defaultUploadState","totalProgress","allowNewUpload","error","recoveredState","_plugins","_classPrivateFieldLooseKey","_restricter","_storeUnsubscribe","_emitter","_preProcessors","_uploaders","_postProcessors","_informAndEmit","_checkRequiredMetaFieldsOnFile","_checkRequiredMetaFields","_assertNewUploadAllowed","_transformFile","_startIfAutoProceed","_checkAndUpdateFileState","_getFilesToRetry","_doRetryAll","_handleUploadProgress","_updateTotalProgress","_updateTotalProgressThrottled","_calculateTotalProgress","_addListeners","_updateOnlineStatus","_requestClientById","_createUpload","_getUpload","_removeUpload","_runUpload","Uppy","constructor","opts","Object","defineProperty","value","_runUpload2","_removeUpload2","_getUpload2","_createUpload2","_addListeners2","_calculateTotalProgress2","_updateTotalProgress2","_doRetryAll2","_getFilesToRetry2","_checkAndUpdateFileState2","_startIfAutoProceed2","_transformFile2","_assertNewUploadAllowed2","_checkRequiredMetaFields2","_checkRequiredMetaFieldsOnFile2","_informAndEmit2","writable","create","Set","scheduledAutoProceed","wasOffline","file","progress","fileInState","getFile","id","undefined","log","percentage","newProgress","bytesTotal","Number","isFinite","Math","round","bytesUploaded","uploadStarted","setFileState","_classPrivateFieldLooseBase","leading","trailing","updateOnlineStatus","bind","Map","defaultLocale","autoProceed","allowMultipleUploadBatches","debug","restrictions","meta","onBeforeFileAdded","files","hasOwn","onBeforeUpload","store","logger","infoTimeout","merged","VERSION","i18nInit","setState","plugins","currentUploads","capabilities","uploadProgress","individualCancellation","resumableUploads","info","i18n","subscribe","prevState","nextState","patch","emit","updateAll","window","event","_len","arguments","length","args","Array","_key","on","callback","once","off","state","iteratePlugins","plugin","update","getState","patchFilesState","filesWithNewState","existingFilesState","fromEntries","entries","map","_ref","fileID","newFileState","Error","onMissingKey","key","translator","translate","i18nArray","translateArray","setOptions","newOpts","setMeta","resetProgress","defaultProgress","uploadComplete","updatedFiles","keys","forEach","tus","transloadit","clear","addPreProcessor","fn","add","removePreProcessor","delete","addPostProcessor","removePostProcessor","addUploader","removeUploader","data","updatedMeta","setFileMeta","newMeta","getFiles","values","getFilesByIds","ids","getObjectOfFilesPerState","filesObject","inProgressFiles","newFiles","startedFiles","uploadStartedFiles","pausedFiles","completeFiles","erroredFiles","inProgressNotPausedFiles","processingFiles","push","isPaused","preprocess","postprocess","isUploadStarted","isAllComplete","isAllErrored","isAllPaused","isUploadInProgress","isSomeGhost","some","isGhost","validateRestrictions","validate","err","validateSingleFile","message","validateAggregateRestrictions","existingFiles","checkIfFileAlreadyExists","addFile","nextFilesState","validFilesToAdd","errors","restrictionErrors","filter","isRestriction","firstValidFileToAdd","name","type","addFiles","fileDescriptors","nonRestrictionErrors","subError","smart_count","details","AggregateError","removeFiles","fileIDs","updatedUploads","removedFiles","fileIsNotRemoved","uploadFileID","uploadID","newFileIDs","stateUpdate","removedFileIDs","join","removeFile","pauseResume","wasPaused","pauseAll","inProgressUpdatedFiles","updatedFile","resumeAll","retryAll","result","cancelAll","retryUpload","forceAllowNewUpload","logout","_provider","provider","Symbol","for","_window$navigator$onL","online","navigator","onLine","getID","use","Plugin","msg","TypeError","_len2","_key2","pluginId","existsPluginAlready","getPlugin","install","foundPlugin","find","method","flat","removePlugin","instance","uninstall","list","index","findIndex","item","splice","updatedState","destroy","removeEventListener","hideInfo","slice","duration","isComplexMessage","setTimeout","warn","registerRequestClient","client","set","getRequestClientForFile","remote","requestClient","get","requestClientId","restore","Promise","reject","addResultData","currentUpload","upload","_classPrivateFieldLoo","filesToRetry","retryResult","hasNewFiles","onBeforeUploadResult","resolve","then","validateMinNumberOfFiles","catch","currentlyUploadingFiles","flatMap","curr","waitingFileIDs","indexOf","userFacingErrors","isUserFacing","maxNumToShow","firstErrors","additionalErrors","_ref2","count","missingFields","getMissingRequiredMetaFields","missingRequiredMetaFields","success","fileDescriptorOrFile","File","size","fileType","fileName","fileExtension","extension","source","isRemote","preview","stack","filesToAdd","fileToAdd","_existingFiles$newFil","newFile","existingFileState","onBeforeFileAddedResult","_newFile$name","successful","failed","_totalProgressPercent","_totalProgressPercent2","totalProgressPercent","filesInProgress","every","isSizedFile","sizedFilesInProgress","unsizedFilesInProgress","totalFilesSize","reduce","acc","_file$progress$bytesT","totalUploadedSize","errorHandler","response","errorMsg","_file$name","newError","uploadStalledWarningRecentlyEmitted","trim","onUploadStarted","filesFiltered","exists","filesState","Date","now","uploadResp","currentProgress","mode","uploadURL","addEventListener","allowMultipleUploads","step","getCurrentUpload","steps","version"],"sources":["Uppy.ts"],"sourcesContent":["/* eslint-disable max-classes-per-file */\n/* global AggregateError */\n\nimport type { h } from 'preact'\nimport Translator from '@uppy/utils/lib/Translator'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore untyped\nimport ee from 'namespace-emitter'\nimport { nanoid } from 'nanoid/non-secure'\nimport throttle from 'lodash/throttle.js'\nimport DefaultStore, { type Store } from '@uppy/store-default'\nimport getFileType from '@uppy/utils/lib/getFileType'\nimport getFileNameAndExtension from '@uppy/utils/lib/getFileNameAndExtension'\nimport { getSafeFileId } from '@uppy/utils/lib/generateFileID'\nimport type {\n  UppyFile,\n  Meta,\n  Body,\n  MinimalRequiredUppyFile,\n} from '@uppy/utils/lib/UppyFile'\nimport type { CompanionFile } from '@uppy/utils/lib/CompanionFile'\nimport type {\n  CompanionClientProvider,\n  CompanionClientSearchProvider,\n} from '@uppy/utils/lib/CompanionClientProvider'\nimport type {\n  FileProgressNotStarted,\n  FileProgressStarted,\n} from '@uppy/utils/lib/FileProgress'\nimport type {\n  Locale,\n  I18n,\n  OptionalPluralizeLocale,\n} from '@uppy/utils/lib/Translator'\nimport supportsUploadProgress from './supportsUploadProgress.js'\nimport getFileName from './getFileName.js'\nimport { justErrorsLogger, debugLogger } from './loggers.js'\nimport {\n  Restricter,\n  defaultOptions as defaultRestrictionOptions,\n  RestrictionError,\n} from './Restricter.js'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nimport type BasePlugin from './BasePlugin.js'\nimport type { Restrictions, ValidateableFile } from './Restricter.js'\n\ntype Processor = (\n  fileIDs: string[],\n  uploadID: string,\n) => Promise<unknown> | void\n\ntype LogLevel = 'info' | 'warning' | 'error' | 'success'\n\nexport type UnknownPlugin<\n  M extends Meta,\n  B extends Body,\n  PluginState extends Record<string, unknown> = Record<string, unknown>,\n> = BasePlugin<any, M, B, PluginState>\n\n/**\n * ids are always `string`s, except the root folder's id can be `null`\n */\nexport type PartialTreeId = string | null\n\nexport type PartialTreeStatusFile = 'checked' | 'unchecked'\nexport type PartialTreeStatus = PartialTreeStatusFile | 'partial'\n\nexport type PartialTreeFile = {\n  type: 'file'\n  id: string\n\n  /**\n   * There exist two types of restrictions:\n   * - individual restrictions (`allowedFileTypes`, `minFileSize`, `maxFileSize`), and\n   * - aggregate restrictions (`maxNumberOfFiles`, `maxTotalFileSize`).\n   *\n   * `.restrictionError` reports whether this file passes individual restrictions.\n   *\n   */\n  restrictionError: string | null\n\n  status: PartialTreeStatusFile\n  parentId: PartialTreeId\n  data: CompanionFile\n}\n\nexport type PartialTreeFolderNode = {\n  type: 'folder'\n  id: string\n\n  /**\n   * Consider `(.nextPagePath, .cached)` a composite key that can represent 4 states:\n   * - `{ cached: true, nextPagePath: null }` - we fetched all pages in this folder\n   * - `{ cached: true, nextPagePath: 'smth' }` - we fetched 1st page, and there are still pages left to fetch in this folder\n   * - `{ cached: false, nextPagePath: null }` - we didn't fetch the 1st page in this folder\n   * - `{ cached: false, nextPagePath: 'someString' }` - ❌ CAN'T HAPPEN ❌\n   */\n  cached: boolean\n  nextPagePath: PartialTreeId\n\n  status: PartialTreeStatus\n  parentId: PartialTreeId\n  data: CompanionFile\n}\n\nexport type PartialTreeFolderRoot = {\n  type: 'root'\n  id: PartialTreeId\n\n  cached: boolean\n  nextPagePath: PartialTreeId\n}\n\nexport type PartialTreeFolder = PartialTreeFolderNode | PartialTreeFolderRoot\n\n/**\n * PartialTree has the following structure.\n *\n *           FolderRoot\n *         ┌─────┴─────┐\n *     FolderNode     File\n *   ┌─────┴────┐\n *  File      File\n *\n * Root folder is called `PartialTreeFolderRoot`,\n * all other folders are called `PartialTreeFolderNode`, because they are \"internal nodes\".\n *\n * It's possible for `PartialTreeFolderNode` to be a leaf node if it doesn't contain any files.\n */\nexport type PartialTree = (PartialTreeFile | PartialTreeFolder)[]\n\nexport type UnknownProviderPluginState = {\n  authenticated: boolean | undefined\n  didFirstRender: boolean\n  searchString: string\n  loading: boolean | string\n  partialTree: PartialTree\n  currentFolderId: PartialTreeId\n  username: string | null\n}\n\nexport interface AsyncStore {\n  getItem: (key: string) => Promise<string | null>\n  setItem: (key: string, value: string) => Promise<void>\n  removeItem: (key: string) => Promise<void>\n}\n\n/**\n * This is a base for a provider that does not necessarily use the Companion-assisted OAuth2 flow\n */\nexport interface BaseProviderPlugin {\n  title: string\n  icon: () => h.JSX.Element\n  storage: AsyncStore\n}\n\n/*\n * UnknownProviderPlugin can be any Companion plugin (such as Google Drive)\n * that uses the Companion-assisted OAuth flow.\n * As the plugins are passed around throughout Uppy we need a generic type for this.\n * It may seems like duplication, but this type safe. Changing the type of `storage`\n * will error in the `Provider` class of @uppy/companion-client and vice versa.\n *\n * Note that this is the *plugin* class, not a version of the `Provider` class.\n * `Provider` does operate on Companion plugins with `uppy.getPlugin()`.\n */\nexport type UnknownProviderPlugin<\n  M extends Meta,\n  B extends Body,\n> = UnknownPlugin<M, B, UnknownProviderPluginState> &\n  BaseProviderPlugin & {\n    rootFolderId: string | null\n    files: UppyFile<M, B>[]\n    provider: CompanionClientProvider\n    // Can't be typed unfortunately, we can't depend on `provider-views` in `core`.\n    view: any\n  }\n\n/*\n * UnknownSearchProviderPlugin can be any search Companion plugin (such as Unsplash).\n * As the plugins are passed around throughout Uppy we need a generic type for this.\n * It may seems like duplication, but this type safe. Changing the type of `title`\n * will error in the `SearchProvider` class of @uppy/companion-client and vice versa.\n *\n * Note that this is the *plugin* class, not a version of the `SearchProvider` class.\n * `SearchProvider` does operate on Companion plugins with `uppy.getPlugin()`.\n */\nexport type UnknownSearchProviderPluginState = {\n  isInputMode: boolean\n} & Pick<\n  UnknownProviderPluginState,\n  'loading' | 'searchString' | 'partialTree' | 'currentFolderId'\n>\nexport type UnknownSearchProviderPlugin<\n  M extends Meta,\n  B extends Body,\n> = UnknownPlugin<M, B, UnknownSearchProviderPluginState> &\n  BaseProviderPlugin & {\n    provider: CompanionClientSearchProvider\n  }\n\nexport interface UploadResult<M extends Meta, B extends Body> {\n  successful?: UppyFile<M, B>[]\n  failed?: UppyFile<M, B>[]\n  uploadID?: string\n  [key: string]: unknown\n}\n\ninterface CurrentUpload<M extends Meta, B extends Body> {\n  fileIDs: string[]\n  step: number\n  result: UploadResult<M, B>\n}\n\n// TODO: can we use namespaces in other plugins to populate this?\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface Plugins extends Record<string, Record<string, unknown> | undefined> {}\n\nexport interface State<M extends Meta, B extends Body>\n  extends Record<string, unknown> {\n  meta: M\n  capabilities: {\n    uploadProgress: boolean\n    individualCancellation: boolean\n    resumableUploads: boolean\n    isMobileDevice?: boolean\n    darkMode?: boolean\n  }\n  currentUploads: Record<string, CurrentUpload<M, B>>\n  allowNewUpload: boolean\n  recoveredState: null | Required<Pick<State<M, B>, 'files' | 'currentUploads'>>\n  error: string | null\n  files: {\n    [key: string]: UppyFile<M, B>\n  }\n  info: Array<{\n    isHidden?: boolean\n    type: LogLevel\n    message: string\n    details?: string | Record<string, string> | null\n  }>\n  plugins: Plugins\n  totalProgress: number\n  companion?: Record<string, string>\n}\n\nexport interface UppyOptions<M extends Meta, B extends Body> {\n  id?: string\n  autoProceed?: boolean\n  /**\n   * @deprecated Use allowMultipleUploadBatches\n   */\n  allowMultipleUploads?: boolean\n  allowMultipleUploadBatches?: boolean\n  logger?: typeof debugLogger\n  debug?: boolean\n  restrictions: Restrictions\n  meta?: M\n  onBeforeFileAdded?: (\n    currentFile: UppyFile<M, B>,\n    files: { [key: string]: UppyFile<M, B> },\n  ) => UppyFile<M, B> | boolean | undefined\n  onBeforeUpload?: (files: {\n    [key: string]: UppyFile<M, B>\n  }) => { [key: string]: UppyFile<M, B> } | boolean\n  locale?: Locale\n  store?: Store<State<M, B>>\n  infoTimeout?: number\n}\n\nexport interface UppyOptionsWithOptionalRestrictions<\n  M extends Meta,\n  B extends Body,\n> extends Omit<UppyOptions<M, B>, 'restrictions'> {\n  restrictions?: Partial<Restrictions>\n}\n\n// The user facing type for UppyOptions used in uppy.setOptions()\ntype MinimalRequiredOptions<M extends Meta, B extends Body> = Partial<\n  Omit<UppyOptions<M, B>, 'locale' | 'meta' | 'restrictions'> & {\n    locale: OptionalPluralizeLocale\n    meta: Partial<M>\n    restrictions: Partial<Restrictions>\n  }\n>\n\nexport type NonNullableUppyOptions<M extends Meta, B extends Body> = Required<\n  UppyOptions<M, B>\n>\n\nexport interface _UppyEventMap<M extends Meta, B extends Body> {\n  'back-online': () => void\n  'cancel-all': () => void\n  complete: (result: UploadResult<M, B>) => void\n  error: (\n    error: { name: string; message: string; details?: string },\n    file?: UppyFile<M, B>,\n    response?: UppyFile<M, B>['response'],\n  ) => void\n  'file-added': (file: UppyFile<M, B>) => void\n  'file-removed': (file: UppyFile<M, B>) => void\n  'files-added': (files: UppyFile<M, B>[]) => void\n  'info-hidden': () => void\n  'info-visible': () => void\n  'is-offline': () => void\n  'is-online': () => void\n  'pause-all': () => void\n  'plugin-added': (plugin: UnknownPlugin<any, any>) => void\n  'plugin-remove': (plugin: UnknownPlugin<any, any>) => void\n  'postprocess-complete': (\n    file: UppyFile<M, B> | undefined,\n    progress?: NonNullable<FileProgressStarted['preprocess']>,\n  ) => void\n  'postprocess-progress': (\n    file: UppyFile<M, B> | undefined,\n    progress: NonNullable<FileProgressStarted['postprocess']>,\n  ) => void\n  'preprocess-complete': (\n    file: UppyFile<M, B> | undefined,\n    progress?: NonNullable<FileProgressStarted['preprocess']>,\n  ) => void\n  'preprocess-progress': (\n    file: UppyFile<M, B> | undefined,\n    progress: NonNullable<FileProgressStarted['preprocess']>,\n  ) => void\n  progress: (progress: number) => void\n  restored: (pluginData: any) => void\n  'restore-confirmed': () => void\n  'restore-canceled': () => void\n  'restriction-failed': (file: UppyFile<M, B> | undefined, error: Error) => void\n  'resume-all': () => void\n  'retry-all': (files: UppyFile<M, B>[]) => void\n  'state-update': (\n    prevState: State<M, B>,\n    nextState: State<M, B>,\n    patch?: Partial<State<M, B>>,\n  ) => void\n  upload: (uploadID: string, files: UppyFile<M, B>[]) => void\n  'upload-error': (\n    file: UppyFile<M, B> | undefined,\n    error: { name: string; message: string; details?: string },\n    response?:\n      | Omit<NonNullable<UppyFile<M, B>['response']>, 'uploadURL'>\n      | undefined,\n  ) => void\n  'upload-pause': (file: UppyFile<M, B> | undefined, isPaused: boolean) => void\n  'upload-progress': (\n    file: UppyFile<M, B> | undefined,\n    progress: FileProgressStarted,\n  ) => void\n  'upload-retry': (file: UppyFile<M, B>) => void\n  'upload-stalled': (\n    error: { message: string; details?: string },\n    files: UppyFile<M, B>[],\n  ) => void\n  'upload-success': (\n    file: UppyFile<M, B> | undefined,\n    response: NonNullable<UppyFile<M, B>['response']>,\n  ) => void\n}\n\nexport interface UppyEventMap<M extends Meta, B extends Body>\n  extends _UppyEventMap<M, B> {\n  'upload-start': (files: UppyFile<M, B>[]) => void\n}\n\n/** `OmitFirstArg<typeof someArray>` is the type of the returned value of `someArray.slice(1)`. */\ntype OmitFirstArg<T> = T extends [any, ...infer U] ? U : never\n\nconst defaultUploadState = {\n  totalProgress: 0,\n  allowNewUpload: true,\n  error: null,\n  recoveredState: null,\n}\n\n/**\n * Uppy Core module.\n * Manages plugins, state updates, acts as an event bus,\n * adds/removes files and metadata.\n */\nexport class Uppy<\n  M extends Meta = Meta,\n  B extends Body = Record<string, never>,\n> {\n  static VERSION = packageJson.version\n\n  #plugins: Record<string, UnknownPlugin<M, B>[]> = Object.create(null)\n\n  #restricter\n\n  #storeUnsubscribe\n\n  #emitter = ee()\n\n  #preProcessors: Set<Processor> = new Set()\n\n  #uploaders: Set<Processor> = new Set()\n\n  #postProcessors: Set<Processor> = new Set()\n\n  defaultLocale: OptionalPluralizeLocale\n\n  locale!: Locale\n\n  // The user optionally passes in options, but we set defaults for missing options.\n  // We consider all options present after the contructor has run.\n  opts: NonNullableUppyOptions<M, B>\n\n  store: NonNullableUppyOptions<M, B>['store']\n\n  // Warning: do not use this from a plugin, as it will cause the plugins' translations to be missing\n  i18n!: I18n\n\n  i18nArray!: Translator['translateArray']\n\n  scheduledAutoProceed: ReturnType<typeof setTimeout> | null = null\n\n  wasOffline = false\n\n  /**\n   * Instantiate Uppy\n   */\n  constructor(opts?: UppyOptionsWithOptionalRestrictions<M, B>) {\n    this.defaultLocale = locale\n\n    const defaultOptions: UppyOptions<Record<string, unknown>, B> = {\n      id: 'uppy',\n      autoProceed: false,\n      allowMultipleUploadBatches: true,\n      debug: false,\n      restrictions: defaultRestrictionOptions,\n      meta: {},\n      onBeforeFileAdded: (file, files) => !Object.hasOwn(files, file.id),\n      onBeforeUpload: (files) => files,\n      store: new DefaultStore(),\n      logger: justErrorsLogger,\n      infoTimeout: 5000,\n    }\n\n    const merged = { ...defaultOptions, ...opts } as Omit<\n      NonNullableUppyOptions<M, B>,\n      'restrictions'\n    >\n    // Merge default options with the ones set by user,\n    // making sure to merge restrictions too\n    this.opts = {\n      ...merged,\n      restrictions: {\n        ...(defaultOptions.restrictions as Restrictions),\n        ...(opts && opts.restrictions),\n      },\n    }\n\n    // Support debug: true for backwards-compatability, unless logger is set in opts\n    // opts instead of this.opts to avoid comparing objects — we set logger: justErrorsLogger in defaultOptions\n    if (opts && opts.logger && opts.debug) {\n      this.log(\n        'You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.',\n        'warning',\n      )\n    } else if (opts && opts.debug) {\n      this.opts.logger = debugLogger\n    }\n\n    this.log(`Using Core v${Uppy.VERSION}`)\n\n    this.i18nInit()\n\n    this.store = this.opts.store\n    this.setState({\n      ...defaultUploadState,\n      plugins: {},\n      files: {},\n      currentUploads: {},\n      capabilities: {\n        uploadProgress: supportsUploadProgress(),\n        individualCancellation: true,\n        resumableUploads: false,\n      },\n      meta: { ...this.opts.meta },\n      info: [],\n    })\n\n    this.#restricter = new Restricter<M, B>(\n      () => this.opts,\n      () => this.i18n,\n    )\n\n    this.#storeUnsubscribe = this.store.subscribe(\n      (prevState, nextState, patch) => {\n        this.emit('state-update', prevState, nextState, patch)\n        this.updateAll(nextState)\n      },\n    )\n\n    // Exposing uppy object on window for debugging and testing\n    if (this.opts.debug && typeof window !== 'undefined') {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore Mutating the global object for debug purposes\n      window[this.opts.id] = this\n    }\n\n    this.#addListeners()\n  }\n\n  emit<T extends keyof UppyEventMap<M, B>>(\n    event: T,\n    ...args: Parameters<UppyEventMap<M, B>[T]>\n  ): void {\n    this.#emitter.emit(event, ...args)\n  }\n\n  on<K extends keyof UppyEventMap<M, B>>(\n    event: K,\n    callback: UppyEventMap<M, B>[K],\n  ): this {\n    this.#emitter.on(event, callback)\n    return this\n  }\n\n  once<K extends keyof UppyEventMap<M, B>>(\n    event: K,\n    callback: UppyEventMap<M, B>[K],\n  ): this {\n    this.#emitter.once(event, callback)\n    return this\n  }\n\n  off<K extends keyof UppyEventMap<M, B>>(\n    event: K,\n    callback: UppyEventMap<M, B>[K],\n  ): this {\n    this.#emitter.off(event, callback)\n    return this\n  }\n\n  /**\n   * Iterate on all plugins and run `update` on them.\n   * Called each time state changes.\n   *\n   */\n  updateAll(state: Partial<State<M, B>>): void {\n    this.iteratePlugins((plugin: UnknownPlugin<M, B>) => {\n      plugin.update(state)\n    })\n  }\n\n  /**\n   * Updates state with a patch\n   */\n  setState(patch?: Partial<State<M, B>>): void {\n    this.store.setState(patch)\n  }\n\n  /**\n   * Returns current state.\n   */\n  getState(): State<M, B> {\n    return this.store.getState()\n  }\n\n  patchFilesState(filesWithNewState: {\n    [id: string]: Partial<UppyFile<M, B>>\n  }): void {\n    const existingFilesState = this.getState().files\n\n    this.setState({\n      files: {\n        ...existingFilesState,\n        ...Object.fromEntries(\n          Object.entries(filesWithNewState).map(([fileID, newFileState]) => [\n            fileID,\n            {\n              ...existingFilesState[fileID],\n              ...newFileState,\n            },\n          ]),\n        ),\n      },\n    })\n  }\n\n  /**\n   * Shorthand to set state for a specific file.\n   */\n  setFileState(fileID: string, state: Partial<UppyFile<M, B>>): void {\n    if (!this.getState().files[fileID]) {\n      throw new Error(\n        `Can’t set state for ${fileID} (the file could have been removed)`,\n      )\n    }\n\n    this.patchFilesState({ [fileID]: state })\n  }\n\n  i18nInit(): void {\n    const onMissingKey = (key: string): void =>\n      this.log(`Missing i18n string: ${key}`, 'error')\n    const translator = new Translator([this.defaultLocale, this.opts.locale], {\n      onMissingKey,\n    })\n    this.i18n = translator.translate.bind(translator)\n    this.i18nArray = translator.translateArray.bind(translator)\n    this.locale = translator.locale\n  }\n\n  setOptions(newOpts: MinimalRequiredOptions<M, B>): void {\n    this.opts = {\n      ...this.opts,\n      ...(newOpts as UppyOptions<M, B>),\n      restrictions: {\n        ...this.opts.restrictions,\n        ...(newOpts?.restrictions as Restrictions),\n      },\n    }\n\n    if (newOpts.meta) {\n      this.setMeta(newOpts.meta)\n    }\n\n    this.i18nInit()\n\n    if (newOpts.locale) {\n      this.iteratePlugins((plugin) => {\n        plugin.setOptions(newOpts)\n      })\n    }\n\n    // Note: this is not the preact `setState`, it's an internal function that has the same name.\n    this.setState(undefined) // so that UI re-renders with new options\n  }\n\n  resetProgress(): void {\n    const defaultProgress: Omit<FileProgressNotStarted, 'bytesTotal'> = {\n      percentage: 0,\n      bytesUploaded: false,\n      uploadComplete: false,\n      uploadStarted: null,\n    }\n    const files = { ...this.getState().files }\n    const updatedFiles: State<M, B>['files'] = Object.create(null)\n\n    Object.keys(files).forEach((fileID) => {\n      updatedFiles[fileID] = {\n        ...files[fileID],\n        progress: {\n          ...files[fileID].progress,\n          ...defaultProgress,\n        },\n        // @ts-expect-error these typed are inserted\n        // into the namespace in their respective packages\n        // but core isn't ware of those\n        tus: undefined,\n        transloadit: undefined,\n      }\n    })\n\n    this.setState({ files: updatedFiles, ...defaultUploadState })\n  }\n\n  clear(): void {\n    const { capabilities, currentUploads } = this.getState()\n    if (\n      Object.keys(currentUploads).length > 0 &&\n      !capabilities.individualCancellation\n    ) {\n      throw new Error(\n        'The installed uploader plugin does not allow removing files during an upload.',\n      )\n    }\n\n    this.setState({ ...defaultUploadState, files: {} })\n  }\n\n  addPreProcessor(fn: Processor): void {\n    this.#preProcessors.add(fn)\n  }\n\n  removePreProcessor(fn: Processor): boolean {\n    return this.#preProcessors.delete(fn)\n  }\n\n  addPostProcessor(fn: Processor): void {\n    this.#postProcessors.add(fn)\n  }\n\n  removePostProcessor(fn: Processor): boolean {\n    return this.#postProcessors.delete(fn)\n  }\n\n  addUploader(fn: Processor): void {\n    this.#uploaders.add(fn)\n  }\n\n  removeUploader(fn: Processor): boolean {\n    return this.#uploaders.delete(fn)\n  }\n\n  setMeta(data: Partial<M>): void {\n    const updatedMeta = { ...this.getState().meta, ...data }\n    const updatedFiles = { ...this.getState().files }\n\n    Object.keys(updatedFiles).forEach((fileID) => {\n      updatedFiles[fileID] = {\n        ...updatedFiles[fileID],\n        meta: { ...updatedFiles[fileID].meta, ...data },\n      }\n    })\n\n    this.log('Adding metadata:')\n    this.log(data)\n\n    this.setState({\n      meta: updatedMeta,\n      files: updatedFiles,\n    })\n  }\n\n  setFileMeta(fileID: string, data: State<M, B>['meta']): void {\n    const updatedFiles = { ...this.getState().files }\n    if (!updatedFiles[fileID]) {\n      this.log(\n        `Was trying to set metadata for a file that has been removed: ${fileID}`,\n      )\n      return\n    }\n    const newMeta = { ...updatedFiles[fileID].meta, ...data }\n    updatedFiles[fileID] = { ...updatedFiles[fileID], meta: newMeta }\n    this.setState({ files: updatedFiles })\n  }\n\n  /**\n   * Get a file object.\n   */\n  getFile(fileID: string): UppyFile<M, B> {\n    return this.getState().files[fileID]\n  }\n\n  /**\n   * Get all files in an array.\n   */\n  getFiles(): UppyFile<M, B>[] {\n    const { files } = this.getState()\n    return Object.values(files)\n  }\n\n  getFilesByIds(ids: string[]): UppyFile<M, B>[] {\n    return ids.map((id) => this.getFile(id))\n  }\n\n  getObjectOfFilesPerState(): {\n    newFiles: UppyFile<M, B>[]\n    startedFiles: UppyFile<M, B>[]\n    uploadStartedFiles: UppyFile<M, B>[]\n    pausedFiles: UppyFile<M, B>[]\n    completeFiles: UppyFile<M, B>[]\n    erroredFiles: UppyFile<M, B>[]\n    inProgressFiles: UppyFile<M, B>[]\n    inProgressNotPausedFiles: UppyFile<M, B>[]\n    processingFiles: UppyFile<M, B>[]\n    isUploadStarted: boolean\n    isAllComplete: boolean\n    isAllErrored: boolean\n    isAllPaused: boolean\n    isUploadInProgress: boolean\n    isSomeGhost: boolean\n  } {\n    const { files: filesObject, totalProgress, error } = this.getState()\n    const files = Object.values(filesObject)\n\n    const inProgressFiles: UppyFile<M, B>[] = []\n    const newFiles: UppyFile<M, B>[] = []\n    const startedFiles: UppyFile<M, B>[] = []\n    const uploadStartedFiles: UppyFile<M, B>[] = []\n    const pausedFiles: UppyFile<M, B>[] = []\n    const completeFiles: UppyFile<M, B>[] = []\n    const erroredFiles: UppyFile<M, B>[] = []\n    const inProgressNotPausedFiles: UppyFile<M, B>[] = []\n    const processingFiles: UppyFile<M, B>[] = []\n\n    for (const file of files) {\n      const { progress } = file\n\n      if (!progress.uploadComplete && progress.uploadStarted) {\n        inProgressFiles.push(file)\n        if (!file.isPaused) {\n          inProgressNotPausedFiles.push(file)\n        }\n      }\n      if (!progress.uploadStarted) {\n        newFiles.push(file)\n      }\n      if (\n        progress.uploadStarted ||\n        progress.preprocess ||\n        progress.postprocess\n      ) {\n        startedFiles.push(file)\n      }\n      if (progress.uploadStarted) {\n        uploadStartedFiles.push(file)\n      }\n      if (file.isPaused) {\n        pausedFiles.push(file)\n      }\n      if (progress.uploadComplete) {\n        completeFiles.push(file)\n      }\n      if (file.error) {\n        erroredFiles.push(file)\n      }\n      if (progress.preprocess || progress.postprocess) {\n        processingFiles.push(file)\n      }\n    }\n\n    return {\n      newFiles,\n      startedFiles,\n      uploadStartedFiles,\n      pausedFiles,\n      completeFiles,\n      erroredFiles,\n      inProgressFiles,\n      inProgressNotPausedFiles,\n      processingFiles,\n\n      isUploadStarted: uploadStartedFiles.length > 0,\n      isAllComplete:\n        totalProgress === 100 &&\n        completeFiles.length === files.length &&\n        processingFiles.length === 0,\n      isAllErrored: !!error && erroredFiles.length === files.length,\n      isAllPaused:\n        inProgressFiles.length !== 0 &&\n        pausedFiles.length === inProgressFiles.length,\n      isUploadInProgress: inProgressFiles.length > 0,\n      isSomeGhost: files.some((file) => file.isGhost),\n    }\n  }\n\n  #informAndEmit(\n    errors: {\n      name: string\n      message: string\n      isUserFacing?: boolean\n      details?: string\n      isRestriction?: boolean\n      file?: UppyFile<M, B>\n    }[],\n  ): void {\n    for (const error of errors) {\n      if (error.isRestriction) {\n        this.emit(\n          'restriction-failed',\n          error.file,\n          error as RestrictionError<M, B>,\n        )\n      } else {\n        this.emit('error', error, error.file)\n      }\n      this.log(error, 'warning')\n    }\n\n    const userFacingErrors = errors.filter((error) => error.isUserFacing)\n\n    // don't flood the user: only show the first 4 toasts\n    const maxNumToShow = 4\n    const firstErrors = userFacingErrors.slice(0, maxNumToShow)\n    const additionalErrors = userFacingErrors.slice(maxNumToShow)\n    firstErrors.forEach(({ message, details = '' }) => {\n      this.info({ message, details }, 'error', this.opts.infoTimeout)\n    })\n\n    if (additionalErrors.length > 0) {\n      this.info({\n        message: this.i18n('additionalRestrictionsFailed', {\n          count: additionalErrors.length,\n        }),\n      })\n    }\n  }\n\n  validateRestrictions(\n    file: ValidateableFile<M, B>,\n    files: ValidateableFile<M, B>[] = this.getFiles(),\n  ): RestrictionError<M, B> | null {\n    try {\n      this.#restricter.validate(files, [file])\n    } catch (err) {\n      return err as any\n    }\n    return null\n  }\n\n  validateSingleFile(file: ValidateableFile<M, B>): string | null {\n    try {\n      this.#restricter.validateSingleFile(file)\n    } catch (err) {\n      return err.message\n    }\n    return null\n  }\n\n  validateAggregateRestrictions(\n    files: ValidateableFile<M, B>[],\n  ): string | null {\n    const existingFiles = this.getFiles()\n    try {\n      this.#restricter.validateAggregateRestrictions(existingFiles, files)\n    } catch (err) {\n      return err.message\n    }\n    return null\n  }\n\n  #checkRequiredMetaFieldsOnFile(file: UppyFile<M, B>): boolean {\n    const { missingFields, error } =\n      this.#restricter.getMissingRequiredMetaFields(file)\n\n    if (missingFields.length > 0) {\n      this.setFileState(file.id, { missingRequiredMetaFields: missingFields })\n      this.log(error.message)\n      this.emit('restriction-failed', file, error)\n      return false\n    }\n    if (missingFields.length === 0 && file.missingRequiredMetaFields) {\n      this.setFileState(file.id, { missingRequiredMetaFields: [] })\n    }\n    return true\n  }\n\n  #checkRequiredMetaFields(files: State<M, B>['files']): boolean {\n    let success = true\n    for (const file of Object.values(files)) {\n      if (!this.#checkRequiredMetaFieldsOnFile(file)) {\n        success = false\n      }\n    }\n    return success\n  }\n\n  #assertNewUploadAllowed(file?: UppyFile<M, B>): void {\n    const { allowNewUpload } = this.getState()\n\n    if (allowNewUpload === false) {\n      const error = new RestrictionError<M, B>(\n        this.i18n('noMoreFilesAllowed'),\n        {\n          file,\n        },\n      )\n      this.#informAndEmit([error])\n      throw error\n    }\n  }\n\n  checkIfFileAlreadyExists(fileID: string): boolean {\n    const { files } = this.getState()\n\n    if (files[fileID] && !files[fileID].isGhost) {\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Create a file state object based on user-provided `addFile()` options.\n   */\n  #transformFile(fileDescriptorOrFile: File | UppyFile<M, B>): UppyFile<M, B> {\n    // Uppy expects files in { name, type, size, data } format.\n    // If the actual File object is passed from input[type=file] or drag-drop,\n    // we normalize it to match Uppy file object\n    const file = (\n      fileDescriptorOrFile instanceof File ?\n        {\n          name: fileDescriptorOrFile.name,\n          type: fileDescriptorOrFile.type,\n          size: fileDescriptorOrFile.size,\n          data: fileDescriptorOrFile,\n        }\n      : fileDescriptorOrFile) as UppyFile<M, B>\n\n    const fileType = getFileType(file)\n    const fileName = getFileName(fileType, file)\n    const fileExtension = getFileNameAndExtension(fileName).extension\n    const id = getSafeFileId(file, this.getID())\n\n    const meta = file.meta || {}\n    meta.name = fileName\n    meta.type = fileType\n\n    // `null` means the size is unknown.\n    const size =\n      Number.isFinite(file.data.size) ? file.data.size : (null as never)\n\n    return {\n      source: file.source || '',\n      id,\n      name: fileName,\n      extension: fileExtension || '',\n      meta: {\n        ...this.getState().meta,\n        ...meta,\n      },\n      type: fileType,\n      data: file.data,\n      progress: {\n        percentage: 0,\n        bytesUploaded: false,\n        bytesTotal: size,\n        uploadComplete: false,\n        uploadStarted: null,\n      },\n      size,\n      isGhost: false,\n      isRemote: file.isRemote || false,\n      remote: file.remote,\n      preview: file.preview,\n    }\n  }\n\n  // Schedule an upload if `autoProceed` is enabled.\n  #startIfAutoProceed(): void {\n    if (this.opts.autoProceed && !this.scheduledAutoProceed) {\n      this.scheduledAutoProceed = setTimeout(() => {\n        this.scheduledAutoProceed = null\n        this.upload().catch((err) => {\n          if (!err.isRestriction) {\n            this.log(err.stack || err.message || err)\n          }\n        })\n      }, 4)\n    }\n  }\n\n  #checkAndUpdateFileState(filesToAdd: UppyFile<M, B>[]): {\n    nextFilesState: State<M, B>['files']\n    validFilesToAdd: UppyFile<M, B>[]\n    errors: RestrictionError<M, B>[]\n  } {\n    const { files: existingFiles } = this.getState()\n\n    // create a copy of the files object only once\n    const nextFilesState = { ...existingFiles }\n    const validFilesToAdd: UppyFile<M, B>[] = []\n    const errors: RestrictionError<M, B>[] = []\n\n    for (const fileToAdd of filesToAdd) {\n      try {\n        let newFile = this.#transformFile(fileToAdd)\n\n        // If a file has been recovered (Golden Retriever), but we were unable to recover its data (probably too large),\n        // users are asked to re-select these half-recovered files and then this method will be called again.\n        // In order to keep the progress, meta and everything else, we keep the existing file,\n        // but we replace `data`, and we remove `isGhost`, because the file is no longer a ghost now\n        const isGhost = existingFiles[newFile.id]?.isGhost\n        if (isGhost) {\n          const existingFileState = existingFiles[newFile.id]\n          newFile = {\n            ...existingFileState,\n            isGhost: false,\n            data: fileToAdd.data,\n          }\n          this.log(\n            `Replaced the blob in the restored ghost file: ${newFile.name}, ${newFile.id}`,\n          )\n        }\n\n        const onBeforeFileAddedResult = this.opts.onBeforeFileAdded(\n          newFile,\n          nextFilesState,\n        )\n\n        if (\n          !onBeforeFileAddedResult &&\n          this.checkIfFileAlreadyExists(newFile.id)\n        ) {\n          throw new RestrictionError(\n            this.i18n('noDuplicates', {\n              fileName: newFile.name ?? this.i18n('unnamed'),\n            }),\n            { file: fileToAdd },\n          )\n        }\n\n        // Pass through reselected files from Golden Retriever\n        if (onBeforeFileAddedResult === false && !isGhost) {\n          // Don’t show UI info for this error, as it should be done by the developer\n          throw new RestrictionError(\n            'Cannot add the file because onBeforeFileAdded returned false.',\n            { isUserFacing: false, file: fileToAdd },\n          )\n        } else if (\n          typeof onBeforeFileAddedResult === 'object' &&\n          onBeforeFileAddedResult !== null\n        ) {\n          newFile = onBeforeFileAddedResult\n        }\n\n        this.#restricter.validateSingleFile(newFile)\n\n        // need to add it to the new local state immediately, so we can use the state to validate the next files too\n        nextFilesState[newFile.id] = newFile\n        validFilesToAdd.push(newFile)\n      } catch (err) {\n        errors.push(err as any)\n      }\n    }\n\n    try {\n      // need to run this separately because it's much more slow, so if we run it inside the for-loop it will be very slow\n      // when many files are added\n      this.#restricter.validateAggregateRestrictions(\n        Object.values(existingFiles),\n        validFilesToAdd,\n      )\n    } catch (err) {\n      errors.push(err as any)\n\n      // If we have any aggregate error, don't allow adding this batch\n      return {\n        nextFilesState: existingFiles,\n        validFilesToAdd: [],\n        errors,\n      }\n    }\n\n    return {\n      nextFilesState,\n      validFilesToAdd,\n      errors,\n    }\n  }\n\n  /**\n   * Add a new file to `state.files`. This will run `onBeforeFileAdded`,\n   * try to guess file type in a clever way, check file against restrictions,\n   * and start an upload if `autoProceed === true`.\n   */\n  addFile(file: File | MinimalRequiredUppyFile<M, B>): UppyFile<M, B>['id'] {\n    this.#assertNewUploadAllowed(file as UppyFile<M, B>)\n\n    const { nextFilesState, validFilesToAdd, errors } =\n      this.#checkAndUpdateFileState([file as UppyFile<M, B>])\n\n    const restrictionErrors = errors.filter((error) => error.isRestriction)\n    this.#informAndEmit(restrictionErrors)\n\n    if (errors.length > 0) throw errors[0]\n\n    this.setState({ files: nextFilesState })\n\n    const [firstValidFileToAdd] = validFilesToAdd\n\n    this.emit('file-added', firstValidFileToAdd)\n    this.emit('files-added', validFilesToAdd)\n    this.log(\n      `Added file: ${firstValidFileToAdd.name}, ${firstValidFileToAdd.id}, mime type: ${firstValidFileToAdd.type}`,\n    )\n\n    this.#startIfAutoProceed()\n\n    return firstValidFileToAdd.id\n  }\n\n  /**\n   * Add multiple files to `state.files`. See the `addFile()` documentation.\n   *\n   * If an error occurs while adding a file, it is logged and the user is notified.\n   * This is good for UI plugins, but not for programmatic use.\n   * Programmatic users should usually still use `addFile()` on individual files.\n   */\n  addFiles(fileDescriptors: MinimalRequiredUppyFile<M, B>[]): void {\n    this.#assertNewUploadAllowed()\n\n    const { nextFilesState, validFilesToAdd, errors } =\n      this.#checkAndUpdateFileState(fileDescriptors as UppyFile<M, B>[])\n\n    const restrictionErrors = errors.filter((error) => error.isRestriction)\n    this.#informAndEmit(restrictionErrors)\n\n    const nonRestrictionErrors = errors.filter((error) => !error.isRestriction)\n\n    if (nonRestrictionErrors.length > 0) {\n      let message = 'Multiple errors occurred while adding files:\\n'\n      nonRestrictionErrors.forEach((subError) => {\n        message += `\\n * ${subError.message}`\n      })\n\n      this.info(\n        {\n          message: this.i18n('addBulkFilesFailed', {\n            smart_count: nonRestrictionErrors.length,\n          }),\n          details: message,\n        },\n        'error',\n        this.opts.infoTimeout,\n      )\n\n      if (typeof AggregateError === 'function') {\n        throw new AggregateError(nonRestrictionErrors, message)\n      } else {\n        const err = new Error(message)\n        // @ts-expect-error fallback when AggregateError is not available\n        err.errors = nonRestrictionErrors\n        throw err\n      }\n    }\n\n    // OK, we haven't thrown an error, we can start updating state and emitting events now:\n\n    this.setState({ files: nextFilesState })\n\n    validFilesToAdd.forEach((file) => {\n      this.emit('file-added', file)\n    })\n\n    this.emit('files-added', validFilesToAdd)\n\n    if (validFilesToAdd.length > 5) {\n      this.log(`Added batch of ${validFilesToAdd.length} files`)\n    } else {\n      Object.values(validFilesToAdd).forEach((file) => {\n        this.log(\n          `Added file: ${file.name}\\n id: ${file.id}\\n type: ${file.type}`,\n        )\n      })\n    }\n\n    if (validFilesToAdd.length > 0) {\n      this.#startIfAutoProceed()\n    }\n  }\n\n  removeFiles(fileIDs: string[]): void {\n    const { files, currentUploads } = this.getState()\n    const updatedFiles = { ...files }\n    const updatedUploads = { ...currentUploads }\n\n    const removedFiles = Object.create(null)\n    fileIDs.forEach((fileID) => {\n      if (files[fileID]) {\n        removedFiles[fileID] = files[fileID]\n        delete updatedFiles[fileID]\n      }\n    })\n\n    // Remove files from the `fileIDs` list in each upload.\n    function fileIsNotRemoved(uploadFileID: string): boolean {\n      return removedFiles[uploadFileID] === undefined\n    }\n\n    Object.keys(updatedUploads).forEach((uploadID) => {\n      const newFileIDs =\n        currentUploads[uploadID].fileIDs.filter(fileIsNotRemoved)\n\n      // Remove the upload if no files are associated with it anymore.\n      if (newFileIDs.length === 0) {\n        delete updatedUploads[uploadID]\n        return\n      }\n\n      const { capabilities } = this.getState()\n      if (\n        newFileIDs.length !== currentUploads[uploadID].fileIDs.length &&\n        !capabilities.individualCancellation\n      ) {\n        throw new Error(\n          'The installed uploader plugin does not allow removing files during an upload.',\n        )\n      }\n\n      updatedUploads[uploadID] = {\n        ...currentUploads[uploadID],\n        fileIDs: newFileIDs,\n      }\n    })\n\n    const stateUpdate: Partial<State<M, B>> = {\n      currentUploads: updatedUploads,\n      files: updatedFiles,\n    }\n\n    // If all files were removed - allow new uploads,\n    // and clear recoveredState\n    if (Object.keys(updatedFiles).length === 0) {\n      stateUpdate.allowNewUpload = true\n      stateUpdate.error = null\n      stateUpdate.recoveredState = null\n    }\n\n    this.setState(stateUpdate)\n    this.#updateTotalProgressThrottled()\n\n    const removedFileIDs = Object.keys(removedFiles)\n    removedFileIDs.forEach((fileID) => {\n      this.emit('file-removed', removedFiles[fileID])\n    })\n\n    if (removedFileIDs.length > 5) {\n      this.log(`Removed ${removedFileIDs.length} files`)\n    } else {\n      this.log(`Removed files: ${removedFileIDs.join(', ')}`)\n    }\n  }\n\n  removeFile(fileID: string): void {\n    this.removeFiles([fileID])\n  }\n\n  pauseResume(fileID: string): boolean | undefined {\n    if (\n      !this.getState().capabilities.resumableUploads ||\n      this.getFile(fileID).progress.uploadComplete\n    ) {\n      return undefined\n    }\n\n    const file = this.getFile(fileID)\n    const wasPaused = file.isPaused || false\n    const isPaused = !wasPaused\n\n    this.setFileState(fileID, {\n      isPaused,\n    })\n\n    this.emit('upload-pause', file, isPaused)\n\n    return isPaused\n  }\n\n  pauseAll(): void {\n    const updatedFiles = { ...this.getState().files }\n    const inProgressUpdatedFiles = Object.keys(updatedFiles).filter((file) => {\n      return (\n        !updatedFiles[file].progress.uploadComplete &&\n        updatedFiles[file].progress.uploadStarted\n      )\n    })\n\n    inProgressUpdatedFiles.forEach((file) => {\n      const updatedFile = { ...updatedFiles[file], isPaused: true }\n      updatedFiles[file] = updatedFile\n    })\n\n    this.setState({ files: updatedFiles })\n    this.emit('pause-all')\n  }\n\n  resumeAll(): void {\n    const updatedFiles = { ...this.getState().files }\n    const inProgressUpdatedFiles = Object.keys(updatedFiles).filter((file) => {\n      return (\n        !updatedFiles[file].progress.uploadComplete &&\n        updatedFiles[file].progress.uploadStarted\n      )\n    })\n\n    inProgressUpdatedFiles.forEach((file) => {\n      const updatedFile = {\n        ...updatedFiles[file],\n        isPaused: false,\n        error: null,\n      }\n      updatedFiles[file] = updatedFile\n    })\n    this.setState({ files: updatedFiles })\n\n    this.emit('resume-all')\n  }\n\n  #getFilesToRetry() {\n    const { files } = this.getState()\n    return Object.keys(files).filter((file) => {\n      return files[file].error\n    })\n  }\n\n  async #doRetryAll(): Promise<UploadResult<M, B> | undefined> {\n    const filesToRetry = this.#getFilesToRetry()\n\n    const updatedFiles = { ...this.getState().files }\n    filesToRetry.forEach((fileID) => {\n      updatedFiles[fileID] = {\n        ...updatedFiles[fileID],\n        isPaused: false,\n        error: null,\n      }\n    })\n\n    this.setState({\n      files: updatedFiles,\n      error: null,\n    })\n\n    this.emit('retry-all', this.getFilesByIds(filesToRetry))\n\n    if (filesToRetry.length === 0) {\n      return {\n        successful: [],\n        failed: [],\n      }\n    }\n\n    const uploadID = this.#createUpload(filesToRetry, {\n      forceAllowNewUpload: true, // create new upload even if allowNewUpload: false\n    })\n    return this.#runUpload(uploadID)\n  }\n\n  async retryAll(): Promise<UploadResult<M, B> | undefined> {\n    const result = await this.#doRetryAll()\n    this.emit('complete', result!)\n    return result\n  }\n\n  cancelAll(): void {\n    this.emit('cancel-all')\n\n    const { files } = this.getState()\n\n    const fileIDs = Object.keys(files)\n    if (fileIDs.length) {\n      this.removeFiles(fileIDs)\n    }\n\n    this.setState(defaultUploadState)\n  }\n\n  retryUpload(fileID: string): Promise<UploadResult<M, B> | undefined> {\n    this.setFileState(fileID, {\n      error: null,\n      isPaused: false,\n    })\n\n    this.emit('upload-retry', this.getFile(fileID))\n\n    const uploadID = this.#createUpload([fileID], {\n      forceAllowNewUpload: true, // create new upload even if allowNewUpload: false\n    })\n    return this.#runUpload(uploadID)\n  }\n\n  logout(): void {\n    this.iteratePlugins((plugin) => {\n      ;(plugin as UnknownProviderPlugin<M, B>).provider?.logout?.()\n    })\n  }\n\n  #handleUploadProgress = (\n    file: UppyFile<M, B> | undefined,\n    progress: FileProgressStarted,\n  ) => {\n    const fileInState = file ? this.getFile(file.id) : undefined\n    if (file == null || !fileInState) {\n      this.log(\n        `Not setting progress for a file that has been removed: ${file?.id}`,\n      )\n      return\n    }\n\n    if (fileInState.progress.percentage === 100) {\n      this.log(\n        `Not setting progress for a file that has been already uploaded: ${file.id}`,\n      )\n      return\n    }\n\n    const newProgress = {\n      bytesTotal: progress.bytesTotal,\n      // bytesTotal may be null or zero; in that case we can't divide by it\n      percentage:\n        (\n          progress.bytesTotal != null &&\n          Number.isFinite(progress.bytesTotal) &&\n          progress.bytesTotal > 0\n        ) ?\n          Math.round((progress.bytesUploaded / progress.bytesTotal) * 100)\n        : undefined,\n    }\n\n    if (fileInState.progress.uploadStarted != null) {\n      this.setFileState(file.id, {\n        progress: {\n          ...fileInState.progress,\n          ...newProgress,\n          bytesUploaded: progress.bytesUploaded,\n        },\n      })\n    } else {\n      this.setFileState(file.id, {\n        progress: {\n          ...fileInState.progress,\n          ...newProgress,\n        },\n      })\n    }\n\n    this.#updateTotalProgressThrottled()\n  }\n\n  #updateTotalProgress() {\n    const totalProgress = this.#calculateTotalProgress()\n    let totalProgressPercent: number | null = null\n    if (totalProgress != null) {\n      totalProgressPercent = Math.round(totalProgress * 100)\n      if (totalProgressPercent > 100) totalProgressPercent = 100\n      else if (totalProgressPercent < 0) totalProgressPercent = 0\n    }\n\n    this.emit('progress', totalProgressPercent ?? 0)\n    this.setState({\n      totalProgress: totalProgressPercent ?? 0,\n    })\n  }\n\n  // ___Why throttle at 500ms?\n  //    - We must throttle at >250ms for superfocus in Dashboard to work well\n  //    (because animation takes 0.25s, and we want to wait for all animations to be over before refocusing).\n  //    [Practical Check]: if thottle is at 100ms, then if you are uploading a file,\n  //    and click 'ADD MORE FILES', - focus won't activate in Firefox.\n  //    - We must throttle at around >500ms to avoid performance lags.\n  //    [Practical Check] Firefox, try to upload a big file for a prolonged period of time. Laptop will start to heat up.\n  #updateTotalProgressThrottled = throttle(\n    () => this.#updateTotalProgress(),\n    500,\n    { leading: true, trailing: true },\n  )\n\n  // eslint-disable-next-line class-methods-use-this, @typescript-eslint/explicit-module-boundary-types\n  private [Symbol.for('uppy test: updateTotalProgress')]() {\n    return this.#updateTotalProgress()\n  }\n\n  #calculateTotalProgress() {\n    // calculate total progress, using the number of files currently uploading,\n    // between 0 and 1 and sum of individual progress of each file\n    const files = this.getFiles()\n\n    // note: also includes files that have completed uploading:\n    const filesInProgress = files.filter((file) => {\n      return (\n        file.progress.uploadStarted ||\n        file.progress.preprocess ||\n        file.progress.postprocess\n      )\n    })\n\n    if (filesInProgress.length === 0) {\n      return 0\n    }\n\n    if (filesInProgress.every((file) => file.progress.uploadComplete)) {\n      // If every uploading file is complete, and we're still getting progress, it probably means\n      // there's a bug somewhere in some progress reporting code (maybe not even our code)\n      // and we're still getting progress, so let's just assume it means a 100% progress\n      return 1\n    }\n\n    const isSizedFile = (file: UppyFile<M, B>) =>\n      file.progress.bytesTotal != null && file.progress.bytesTotal !== 0\n\n    const sizedFilesInProgress = filesInProgress.filter(isSizedFile)\n    const unsizedFilesInProgress = filesInProgress.filter(\n      (file) => !isSizedFile(file),\n    )\n\n    if (\n      sizedFilesInProgress.every((file) => file.progress.uploadComplete) &&\n      unsizedFilesInProgress.length > 0 &&\n      !unsizedFilesInProgress.every((file) => file.progress.uploadComplete)\n    ) {\n      // we are done with uploading all files of known size, however\n      // there is at least one file with unknown size still uploading,\n      // and we cannot say anything about their progress\n      // In any case, return null because it doesn't make any sense to show a progress\n      return null\n    }\n\n    const totalFilesSize = sizedFilesInProgress.reduce(\n      (acc, file) => acc + (file.progress.bytesTotal ?? 0),\n      0,\n    )\n\n    const totalUploadedSize = sizedFilesInProgress.reduce(\n      (acc, file) => acc + (file.progress.bytesUploaded || 0),\n      0,\n    )\n\n    return totalFilesSize === 0 ? 0 : totalUploadedSize / totalFilesSize\n  }\n\n  /**\n   * Registers listeners for all global actions, like:\n   * `error`, `file-removed`, `upload-progress`\n   */\n  #addListeners(): void {\n    // Type inference only works for inline functions so we have to type it again\n    const errorHandler: UppyEventMap<M, B>['error'] = (\n      error,\n      file,\n      response,\n    ) => {\n      let errorMsg = error.message || 'Unknown error'\n      if (error.details) {\n        errorMsg += ` ${error.details}`\n      }\n\n      this.setState({ error: errorMsg })\n\n      if (file != null && file.id in this.getState().files) {\n        this.setFileState(file.id, {\n          error: errorMsg,\n          response,\n        })\n      }\n    }\n\n    this.on('error', errorHandler)\n\n    this.on('upload-error', (file, error, response) => {\n      errorHandler(error, file, response)\n\n      if (typeof error === 'object' && error.message) {\n        this.log(error.message, 'error')\n        const newError = new Error(\n          this.i18n('failedToUpload', { file: file?.name ?? '' }),\n        ) as any // we may want a new custom error here\n        newError.isUserFacing = true // todo maybe don't do this with all errors?\n        newError.details = error.message\n        if (error.details) {\n          newError.details += ` ${error.details}`\n        }\n        this.#informAndEmit([newError])\n      } else {\n        this.#informAndEmit([error])\n      }\n    })\n\n    let uploadStalledWarningRecentlyEmitted: ReturnType<\n      typeof setTimeout\n    > | null = null\n    this.on('upload-stalled', (error, files) => {\n      const { message } = error\n      const details = files.map((file) => file.meta.name).join(', ')\n      if (!uploadStalledWarningRecentlyEmitted) {\n        this.info({ message, details }, 'warning', this.opts.infoTimeout)\n        uploadStalledWarningRecentlyEmitted = setTimeout(() => {\n          uploadStalledWarningRecentlyEmitted = null\n        }, this.opts.infoTimeout)\n      }\n      this.log(`${message} ${details}`.trim(), 'warning')\n    })\n\n    this.on('upload', () => {\n      this.setState({ error: null })\n    })\n\n    const onUploadStarted = (files: UppyFile<M, B>[]): void => {\n      const filesFiltered = files.filter((file) => {\n        const exists = file != null && this.getFile(file.id)\n        if (!exists)\n          this.log(\n            `Not setting progress for a file that has been removed: ${file?.id}`,\n          )\n        return exists\n      })\n\n      const filesState = Object.fromEntries(\n        filesFiltered.map((file) => [\n          file.id,\n          {\n            progress: {\n              uploadStarted: Date.now(),\n              uploadComplete: false,\n              bytesUploaded: 0,\n              bytesTotal: file.size,\n            } as FileProgressStarted,\n          },\n        ]),\n      )\n\n      this.patchFilesState(filesState)\n    }\n\n    this.on('upload-start', onUploadStarted)\n\n    this.on('upload-progress', this.#handleUploadProgress)\n\n    this.on('upload-success', (file, uploadResp) => {\n      if (file == null || !this.getFile(file.id)) {\n        this.log(\n          `Not setting progress for a file that has been removed: ${file?.id}`,\n        )\n        return\n      }\n\n      const currentProgress = this.getFile(file.id).progress\n      this.setFileState(file.id, {\n        progress: {\n          ...currentProgress,\n          postprocess:\n            this.#postProcessors.size > 0 ?\n              {\n                mode: 'indeterminate',\n              }\n            : undefined,\n          uploadComplete: true,\n          percentage: 100,\n          bytesUploaded: currentProgress.bytesTotal,\n        } as FileProgressStarted,\n        response: uploadResp,\n        uploadURL: uploadResp.uploadURL,\n        isPaused: false,\n      })\n\n      // Remote providers sometimes don't tell us the file size,\n      // but we can know how many bytes we uploaded once the upload is complete.\n      if (file.size == null) {\n        this.setFileState(file.id, {\n          size: uploadResp.bytesUploaded || currentProgress.bytesTotal,\n        })\n      }\n\n      this.#updateTotalProgressThrottled()\n    })\n\n    this.on('preprocess-progress', (file, progress) => {\n      if (file == null || !this.getFile(file.id)) {\n        this.log(\n          `Not setting progress for a file that has been removed: ${file?.id}`,\n        )\n        return\n      }\n      this.setFileState(file.id, {\n        progress: { ...this.getFile(file.id).progress, preprocess: progress },\n      })\n    })\n\n    this.on('preprocess-complete', (file) => {\n      if (file == null || !this.getFile(file.id)) {\n        this.log(\n          `Not setting progress for a file that has been removed: ${file?.id}`,\n        )\n        return\n      }\n      const files = { ...this.getState().files }\n      files[file.id] = {\n        ...files[file.id],\n        progress: { ...files[file.id].progress },\n      }\n      delete files[file.id].progress.preprocess\n\n      this.setState({ files })\n    })\n\n    this.on('postprocess-progress', (file, progress) => {\n      if (file == null || !this.getFile(file.id)) {\n        this.log(\n          `Not setting progress for a file that has been removed: ${file?.id}`,\n        )\n        return\n      }\n      this.setFileState(file.id, {\n        progress: {\n          ...this.getState().files[file.id].progress,\n          postprocess: progress,\n        },\n      })\n    })\n\n    this.on('postprocess-complete', (file) => {\n      if (file == null || !this.getFile(file.id)) {\n        this.log(\n          `Not setting progress for a file that has been removed: ${file?.id}`,\n        )\n        return\n      }\n      const files = {\n        ...this.getState().files,\n      }\n      files[file.id] = {\n        ...files[file.id],\n        progress: {\n          ...files[file.id].progress,\n        },\n      }\n      delete files[file.id].progress.postprocess\n\n      this.setState({ files })\n    })\n\n    this.on('restored', () => {\n      // Files may have changed--ensure progress is still accurate.\n      this.#updateTotalProgressThrottled()\n    })\n\n    // @ts-expect-error should fix itself when dashboard it typed (also this doesn't belong here)\n    this.on('dashboard:file-edit-complete', (file) => {\n      if (file) {\n        this.#checkRequiredMetaFieldsOnFile(file)\n      }\n    })\n\n    // show informer if offline\n    if (typeof window !== 'undefined' && window.addEventListener) {\n      window.addEventListener('online', this.#updateOnlineStatus)\n      window.addEventListener('offline', this.#updateOnlineStatus)\n      setTimeout(this.#updateOnlineStatus, 3000)\n    }\n  }\n\n  updateOnlineStatus(): void {\n    const online = window.navigator.onLine ?? true\n    if (!online) {\n      this.emit('is-offline')\n      this.info(this.i18n('noInternetConnection'), 'error', 0)\n      this.wasOffline = true\n    } else {\n      this.emit('is-online')\n      if (this.wasOffline) {\n        this.emit('back-online')\n        this.info(this.i18n('connectedToInternet'), 'success', 3000)\n        this.wasOffline = false\n      }\n    }\n  }\n\n  #updateOnlineStatus = this.updateOnlineStatus.bind(this)\n\n  getID(): string {\n    return this.opts.id\n  }\n\n  /**\n   * Registers a plugin with Core.\n   */\n  use<T extends typeof BasePlugin<any, M, B>>(\n    Plugin: T,\n    // We want to let the plugin decide whether `opts` is optional or not\n    // so we spread the argument rather than defining `opts:` ourselves.\n    ...args: OmitFirstArg<ConstructorParameters<T>>\n  ): this {\n    if (typeof Plugin !== 'function') {\n      const msg =\n        `Expected a plugin class, but got ${\n          Plugin === null ? 'null' : typeof Plugin\n        }.` +\n        ' Please verify that the plugin was imported and spelled correctly.'\n      throw new TypeError(msg)\n    }\n\n    // Instantiate\n    const plugin = new Plugin(this, ...args)\n    const pluginId = plugin.id\n\n    if (!pluginId) {\n      throw new Error('Your plugin must have an id')\n    }\n\n    if (!plugin.type) {\n      throw new Error('Your plugin must have a type')\n    }\n\n    const existsPluginAlready = this.getPlugin(pluginId)\n    if (existsPluginAlready) {\n      const msg =\n        `Already found a plugin named '${existsPluginAlready.id}'. ` +\n        `Tried to use: '${pluginId}'.\\n` +\n        'Uppy plugins must have unique `id` options.'\n      throw new Error(msg)\n    }\n\n    // @ts-expect-error does exist\n    if (Plugin.VERSION) {\n      // @ts-expect-error does exist\n      this.log(`Using ${pluginId} v${Plugin.VERSION}`)\n    }\n\n    if (plugin.type in this.#plugins) {\n      this.#plugins[plugin.type].push(plugin)\n    } else {\n      this.#plugins[plugin.type] = [plugin]\n    }\n    plugin.install()\n\n    this.emit('plugin-added', plugin)\n\n    return this\n  }\n\n  /**\n   * Find one Plugin by name.\n   */\n  getPlugin<T extends UnknownPlugin<M, B> = UnknownPlugin<M, B>>(\n    id: string,\n  ): T | undefined {\n    for (const plugins of Object.values(this.#plugins)) {\n      const foundPlugin = plugins.find((plugin) => plugin.id === id)\n      if (foundPlugin != null) return foundPlugin as T\n    }\n    return undefined\n  }\n\n  private [Symbol.for('uppy test: getPlugins')](\n    type: string,\n  ): UnknownPlugin<M, B>[] {\n    return this.#plugins[type]\n  }\n\n  /**\n   * Iterate through all `use`d plugins.\n   *\n   */\n  iteratePlugins(method: (plugin: UnknownPlugin<M, B>) => void): void {\n    Object.values(this.#plugins).flat(1).forEach(method)\n  }\n\n  /**\n   * Uninstall and remove a plugin.\n   *\n   * @param {object} instance The plugin instance to remove.\n   */\n  removePlugin(instance: UnknownPlugin<M, B>): void {\n    this.log(`Removing plugin ${instance.id}`)\n    this.emit('plugin-remove', instance)\n\n    if (instance.uninstall) {\n      instance.uninstall()\n    }\n\n    const list = this.#plugins[instance.type]\n    // list.indexOf failed here, because Vue3 converted the plugin instance\n    // to a Proxy object, which failed the strict comparison test:\n    // obj !== objProxy\n    const index = list.findIndex((item) => item.id === instance.id)\n    if (index !== -1) {\n      list.splice(index, 1)\n    }\n\n    const state = this.getState()\n    const updatedState = {\n      plugins: {\n        ...state.plugins,\n        [instance.id]: undefined,\n      },\n    }\n    this.setState(updatedState)\n  }\n\n  /**\n   * Uninstall all plugins and close down this Uppy instance.\n   */\n  destroy(): void {\n    this.log(\n      `Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`,\n    )\n\n    this.cancelAll()\n\n    this.#storeUnsubscribe()\n\n    this.iteratePlugins((plugin) => {\n      this.removePlugin(plugin)\n    })\n\n    if (typeof window !== 'undefined' && window.removeEventListener) {\n      window.removeEventListener('online', this.#updateOnlineStatus)\n      window.removeEventListener('offline', this.#updateOnlineStatus)\n    }\n  }\n\n  hideInfo(): void {\n    const { info } = this.getState()\n\n    this.setState({ info: info.slice(1) })\n\n    this.emit('info-hidden')\n  }\n\n  /**\n   * Set info message in `state.info`, so that UI plugins like `Informer`\n   * can display the message.\n   */\n  info(\n    message:\n      | string\n      | { message: string; details?: string | Record<string, string> },\n    type: LogLevel = 'info',\n    duration = 3000,\n  ): void {\n    const isComplexMessage = typeof message === 'object'\n\n    this.setState({\n      info: [\n        ...this.getState().info,\n        {\n          type,\n          message: isComplexMessage ? message.message : message,\n          details: isComplexMessage ? message.details : null,\n        },\n      ],\n    })\n\n    setTimeout(() => this.hideInfo(), duration)\n\n    this.emit('info-visible')\n  }\n\n  /**\n   * Passes messages to a function, provided in `opts.logger`.\n   * If `opts.logger: Uppy.debugLogger` or `opts.debug: true`, logs to the browser console.\n   */\n  log(message: unknown, type?: 'error' | 'warning'): void {\n    const { logger } = this.opts\n    switch (type) {\n      case 'error':\n        logger.error(message)\n        break\n      case 'warning':\n        logger.warn(message)\n        break\n      default:\n        logger.debug(message)\n        break\n    }\n  }\n\n  // We need to store request clients by a unique ID, so we can share RequestClient instances across files\n  // this allows us to do rate limiting and synchronous operations like refreshing provider tokens\n  // example: refreshing tokens: if each file has their own requestclient,\n  // we don't have any way to synchronize all requests in order to\n  // - block all requests\n  // - refresh the token\n  // - unblock all requests and allow them to run with a the new access token\n  // back when we had a requestclient per file, once an access token expired,\n  // all 6 files would go ahead and refresh the token at the same time\n  // (calling /refresh-token up to 6 times), which will probably fail for some providers\n  #requestClientById = new Map<string, unknown>()\n\n  registerRequestClient(id: string, client: unknown): void {\n    this.#requestClientById.set(id, client)\n  }\n\n  /** @protected */\n  getRequestClientForFile<Client>(file: UppyFile<M, B>): Client {\n    if (!file.remote)\n      throw new Error(\n        `Tried to get RequestClient for a non-remote file ${file.id}`,\n      )\n    const requestClient = this.#requestClientById.get(\n      file.remote.requestClientId,\n    )\n    if (requestClient == null)\n      throw new Error(\n        `requestClientId \"${file.remote.requestClientId}\" not registered for file \"${file.id}\"`,\n      )\n    return requestClient as Client\n  }\n\n  /**\n   * Restore an upload by its ID.\n   */\n  restore(uploadID: string): Promise<UploadResult<M, B> | undefined> {\n    this.log(`Core: attempting to restore upload \"${uploadID}\"`)\n\n    if (!this.getState().currentUploads[uploadID]) {\n      this.#removeUpload(uploadID)\n      return Promise.reject(new Error('Nonexistent upload'))\n    }\n\n    return this.#runUpload(uploadID)\n  }\n\n  /**\n   * Create an upload for a bunch of files.\n   *\n   */\n  #createUpload(\n    fileIDs: string[],\n    opts: { forceAllowNewUpload?: boolean } = {},\n  ): string {\n    // uppy.retryAll sets this to true — when retrying we want to ignore `allowNewUpload: false`\n    const { forceAllowNewUpload = false } = opts\n\n    const { allowNewUpload, currentUploads } = this.getState()\n    if (!allowNewUpload && !forceAllowNewUpload) {\n      throw new Error('Cannot create a new upload: already uploading.')\n    }\n\n    const uploadID = nanoid()\n\n    this.emit('upload', uploadID, this.getFilesByIds(fileIDs))\n\n    this.setState({\n      allowNewUpload:\n        this.opts.allowMultipleUploadBatches !== false &&\n        this.opts.allowMultipleUploads !== false,\n\n      currentUploads: {\n        ...currentUploads,\n        [uploadID]: {\n          fileIDs,\n          step: 0,\n          result: {},\n        },\n      },\n    })\n\n    return uploadID\n  }\n\n  private [Symbol.for('uppy test: createUpload')](...args: any[]): string {\n    // @ts-expect-error https://github.com/microsoft/TypeScript/issues/47595\n    return this.#createUpload(...args)\n  }\n\n  #getUpload(uploadID: string): CurrentUpload<M, B> {\n    const { currentUploads } = this.getState()\n\n    return currentUploads[uploadID]\n  }\n\n  /**\n   * Add data to an upload's result object.\n   */\n  addResultData(uploadID: string, data: CurrentUpload<M, B>['result']): void {\n    if (!this.#getUpload(uploadID)) {\n      this.log(\n        `Not setting result for an upload that has been removed: ${uploadID}`,\n      )\n      return\n    }\n    const { currentUploads } = this.getState()\n    const currentUpload = {\n      ...currentUploads[uploadID],\n      result: { ...currentUploads[uploadID].result, ...data },\n    }\n    this.setState({\n      currentUploads: { ...currentUploads, [uploadID]: currentUpload },\n    })\n  }\n\n  /**\n   * Remove an upload, eg. if it has been canceled or completed.\n   *\n   */\n  #removeUpload(uploadID: string): void {\n    const currentUploads = { ...this.getState().currentUploads }\n    delete currentUploads[uploadID]\n\n    this.setState({\n      currentUploads,\n    })\n  }\n\n  /**\n   * Run an upload. This picks up where it left off in case the upload is being restored.\n   */\n  async #runUpload(uploadID: string): Promise<UploadResult<M, B> | undefined> {\n    const getCurrentUpload = (): CurrentUpload<M, B> => {\n      const { currentUploads } = this.getState()\n      return currentUploads[uploadID]\n    }\n\n    let currentUpload = getCurrentUpload()\n\n    const steps = [\n      ...this.#preProcessors,\n      ...this.#uploaders,\n      ...this.#postProcessors,\n    ]\n    try {\n      for (let step = currentUpload.step || 0; step < steps.length; step++) {\n        if (!currentUpload) {\n          break\n        }\n        const fn = steps[step]\n\n        this.setState({\n          currentUploads: {\n            ...this.getState().currentUploads,\n            [uploadID]: {\n              ...currentUpload,\n              step,\n            },\n          },\n        })\n\n        const { fileIDs } = currentUpload\n\n        // TODO give this the `updatedUpload` object as its only parameter maybe?\n        // Otherwise when more metadata may be added to the upload this would keep getting more parameters\n        await fn(fileIDs, uploadID)\n\n        // Update currentUpload value in case it was modified asynchronously.\n        currentUpload = getCurrentUpload()\n      }\n    } catch (err) {\n      this.#removeUpload(uploadID)\n      throw err\n    }\n\n    // Set result data.\n    if (currentUpload) {\n      // Mark postprocessing step as complete if necessary; this addresses a case where we might get\n      // stuck in the postprocessing UI while the upload is fully complete.\n      // If the postprocessing steps do not do any work, they may not emit postprocessing events at\n      // all, and never mark the postprocessing as complete. This is fine on its own but we\n      // introduced code in the @uppy/core upload-success handler to prepare postprocessing progress\n      // state if any postprocessors are registered. That is to avoid a \"flash of completed state\"\n      // before the postprocessing plugins can emit events.\n      //\n      // So, just in case an upload with postprocessing plugins *has* completed *without* emitting\n      // postprocessing completion, we do it instead.\n      currentUpload.fileIDs.forEach((fileID) => {\n        const file = this.getFile(fileID)\n        if (file && file.progress.postprocess) {\n          this.emit('postprocess-complete', file)\n        }\n      })\n\n      const files = currentUpload.fileIDs.map((fileID) => this.getFile(fileID))\n      const successful = files.filter((file) => !file.error)\n      const failed = files.filter((file) => file.error)\n      this.addResultData(uploadID, { successful, failed, uploadID })\n\n      // Update currentUpload value in case it was modified asynchronously.\n      currentUpload = getCurrentUpload()\n    }\n    // Emit completion events.\n    // This is in a separate function so that the `currentUploads` variable\n    // always refers to the latest state. In the handler right above it refers\n    // to an outdated object without the `.result` property.\n    let result\n    if (currentUpload) {\n      result = currentUpload.result\n      this.#removeUpload(uploadID)\n    }\n    if (result == null) {\n      this.log(\n        `Not setting result for an upload that has been removed: ${uploadID}`,\n      )\n      result = {\n        successful: [],\n        failed: [],\n        uploadID,\n      }\n    }\n    return result\n  }\n\n  /**\n   * Start an upload for all the files that are not currently being uploaded.\n   */\n  async upload(): Promise<NonNullable<UploadResult<M, B>> | undefined> {\n    if (!this.#plugins['uploader']?.length) {\n      this.log('No uploader type plugins are used', 'warning')\n    }\n\n    let { files } = this.getState()\n\n    // retry any failed files from a previous upload() call\n    const filesToRetry = this.#getFilesToRetry()\n    if (filesToRetry.length > 0) {\n      const retryResult = await this.#doRetryAll() // we don't want the complete event to fire\n\n      const hasNewFiles =\n        this.getFiles().filter((file) => file.progress.uploadStarted == null)\n          .length > 0\n\n      // if no new files, make it idempotent and return\n      if (!hasNewFiles) {\n        this.emit('complete', retryResult!)\n        return retryResult\n      }\n      // reload files which might have  changed after retry\n      ;({ files } = this.getState())\n    }\n\n    // If no files to retry, proceed with original upload() behavior for new files\n    const onBeforeUploadResult = this.opts.onBeforeUpload(files)\n\n    if (onBeforeUploadResult === false) {\n      return Promise.reject(\n        new Error(\n          'Not starting the upload because onBeforeUpload returned false',\n        ),\n      )\n    }\n\n    if (onBeforeUploadResult && typeof onBeforeUploadResult === 'object') {\n      files = onBeforeUploadResult\n      // Updating files in state, because uploader plugins receive file IDs,\n      // and then fetch the actual file object from state\n      this.setState({\n        files,\n      })\n    }\n\n    return Promise.resolve()\n      .then(() => this.#restricter.validateMinNumberOfFiles(files))\n      .catch((err) => {\n        this.#informAndEmit([err])\n        throw err\n      })\n      .then(() => {\n        if (!this.#checkRequiredMetaFields(files)) {\n          throw new RestrictionError(this.i18n('missingRequiredMetaField'))\n        }\n      })\n      .catch((err) => {\n        // Doing this in a separate catch because we already emited and logged\n        // all the errors in `checkRequiredMetaFields` so we only throw a generic\n        // missing fields error here.\n        throw err\n      })\n      .then(async () => {\n        const { currentUploads } = this.getState()\n        // get a list of files that are currently assigned to uploads\n        const currentlyUploadingFiles = Object.values(currentUploads).flatMap(\n          (curr) => curr.fileIDs,\n        )\n\n        const waitingFileIDs: string[] = []\n        Object.keys(files).forEach((fileID) => {\n          const file = this.getFile(fileID)\n          // if the file hasn't started uploading and hasn't already been assigned to an upload..\n          if (\n            !file.progress.uploadStarted &&\n            currentlyUploadingFiles.indexOf(fileID) === -1\n          ) {\n            waitingFileIDs.push(file.id)\n          }\n        })\n\n        const uploadID = this.#createUpload(waitingFileIDs)\n        const result = await this.#runUpload(uploadID)\n        this.emit('complete', result!)\n        return result\n      })\n      .catch((err) => {\n        this.emit('error', err)\n        this.log(err, 'error')\n        throw err\n      })\n  }\n}\n\nexport default Uppy\n"],"mappings":"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","ignoreList":[]}