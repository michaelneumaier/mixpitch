name = "mixpitch-bulk-download-consumer-prod"
main = "src/consumer.ts"
compatibility_date = "2024-12-04"

# CPU time limit (1 minute for large file processing)
[limits]
cpu_ms = 60000

# Queue consumer configuration - PRODUCTION queues
[[queues.consumers]]
queue = "mixpitch-bulk-downloads-prod"
max_batch_size = 1
max_retries = 3
dead_letter_queue = "mixpitch-bulk-downloads-prod-dlq"

# R2 bucket binding - PRODUCTION bucket
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "mixpitch-prod"
preview_bucket_name = "mixpitch-prod"

# Observability and logging
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# Environment variables (set via wrangler secret)
# CALLBACK_SECRET - for HMAC signature verification
# CALLBACK_URL - Laravel callback endpoint (https://mixpitch.com/api/bulk-download/callback)
